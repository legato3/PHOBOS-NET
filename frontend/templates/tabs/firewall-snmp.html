<div x-show="activeTab === 'firewall-snmp'" :style="activeTab === 'firewall-snmp' ? 'display:block' : 'display:none'"
    id="firewall-snmp-tab" role="tabpanel" aria-labelledby="firewall-snmp-tab-btn" tabindex="0">
    <section id="section-firewall-snmp" class="scroll-section" style="margin-bottom: 32px;">

        <!-- Loading State -->
        <template x-if="firewallSNMP.loading">
            <div class="empty-state">
                <div class="loader">Loading firewall status...</div>
            </div>
        </template>

        <!-- Error State -->
        <template x-if="!firewallSNMP.loading && firewallSNMP.error && !firewallSNMP.poll_success">
            <div class="empty-state">
                <div style="font-size: 32px; margin-bottom: var(--space-2);" aria-hidden="true">‚öôÔ∏è
                </div>
                <p
                    style="font-size: var(--text-base); margin-bottom: var(--space-1); font-weight: var(--font-weight-semibold);">
                    SNMP Not Configured</p>
                <p style="font-size: var(--text-sm); color: var(--text-tertiary); margin-bottom: var(--space-3);"
                    x-text="firewallSNMP.error">
                </p>
                <p style="font-size: var(--text-sm); color: var(--text-secondary);">
                    Configure SNMP in <button @click="configModalOpen = true" class="btn btn--ghost"
                        style="display: inline-flex; padding: 4px 12px; margin: 0 4px;">‚öôÔ∏è Settings</button> to monitor
                    firewall interfaces.
                </p>
            </div>
        </template>
        <!-- Content -->
        <template x-if="!firewallSNMP.loading && firewallSNMP.poll_success">
            <div>
                <!-- System Stats -->
                <div class="grid mb-6 grid-auto-fit" style="margin-bottom: var(--space-6) !important;">
                    <div class="card stat-box">
                        <div class="value" :class="{ 'text-warn': firewallSNMP.cpu_percent > 80, 'text-crit': firewallSNMP.cpu_percent > 90 }"
                            x-text="firewallSNMP.cpu_percent !== null ? firewallSNMP.cpu_percent.toFixed(1) + '%' : '‚Äî'"></div>
                        <div class="label">CPU</div>
                    </div>
                    <div class="card stat-box">
                        <div class="value" :class="{ 'text-warn': firewallSNMP.memory_percent > 80, 'text-crit': firewallSNMP.memory_percent > 90 }"
                            x-text="firewallSNMP.memory_percent !== null ? firewallSNMP.memory_percent.toFixed(1) + '%' : '‚Äî'"></div>
                        <div class="label">Memory</div>
                    </div>
                    <div class="card stat-box">
                        <div class="value" :class="{ 'text-warn': firewallSNMP.swap_percent > 50, 'text-crit': firewallSNMP.swap_percent > 80 }"
                            x-text="firewallSNMP.swap_percent != null ? firewallSNMP.swap_percent.toFixed(1) + '%' : '‚Äî'"></div>
                        <div class="label">Swap</div>
                    </div>
                    <div class="card stat-box">
                        <div class="value" x-text="firewallSNMP.process_count != null ? firewallSNMP.process_count.toLocaleString() : '‚Äî'"></div>
                        <div class="label">Processes</div>
                    </div>
                    <div class="card stat-box">
                        <div class="value" x-text="firewallSNMP.active_sessions !== null ? firewallSNMP.active_sessions.toLocaleString() : '‚Äî'"></div>
                        <div class="label">Sessions</div>
                    </div>
                    <div class="card stat-box">
                        <div class="value" style="font-size: 1.1em;" x-text="firewallSNMP.uptime_formatted || '‚Äî'"></div>
                        <div class="label">Uptime</div>
                    </div>
                </div>

                <!-- Network Stats -->
                <div class="grid mb-6 grid-auto-fit" style="margin-bottom: var(--space-6) !important;">
                    <div class="card stat-box">
                        <div class="value text-cyan" x-text="firewallSNMP.total_throughput_mbps !== null ? firewallSNMP.total_throughput_mbps.toFixed(2) : '‚Äî'"></div>
                        <div class="label">Throughput Mbps</div>
                    </div>
                    <div class="card stat-box">
                        <div class="value" x-text="firewallSNMP.ip_forwarding_s != null ? firewallSNMP.ip_forwarding_s.toFixed(0) : '‚Äî'"></div>
                        <div class="label">IP Fwd/s</div>
                    </div>
                    <div class="card stat-box">
                        <div class="value" :class="{ 'text-warn': firewallSNMP.tcp_retrans_s > 10, 'text-crit': firewallSNMP.tcp_retrans_s > 50 }"
                            x-text="firewallSNMP.tcp_retrans_s != null ? firewallSNMP.tcp_retrans_s.toFixed(1) : '‚Äî'"></div>
                        <div class="label">TCP Retrans/s</div>
                    </div>
                    <div class="card stat-box">
                        <div class="value" :class="{ 'text-warn': firewallSNMP.tcp_resets_s > 5, 'text-crit': firewallSNMP.tcp_resets_s > 20 }"
                            x-text="firewallSNMP.tcp_resets_s != null ? firewallSNMP.tcp_resets_s.toFixed(1) : '‚Äî'"></div>
                        <div class="label">TCP Resets/s</div>
                    </div>
                    <div class="card stat-box">
                        <div class="value" x-text="firewallSNMP.udp_in_s != null ? firewallSNMP.udp_in_s.toFixed(0) : '‚Äî'"></div>
                        <div class="label">UDP In/s</div>
                    </div>
                    <div class="card stat-box">
                        <div class="value" x-text="firewallSNMP.udp_out_s != null ? firewallSNMP.udp_out_s.toFixed(0) : '‚Äî'"></div>
                        <div class="label">UDP Out/s</div>
                    </div>
                </div>

                <!-- Interface Table -->
                <div class="card">
                    <h2>
                        <div class="card-title-content">
                            <span class="title-icon">üåê</span>
                            <span>Network Interfaces</span>
                        </div>
                    </h2>
                    <div class="widget-body">
                        <template x-if="firewallSNMP.interfaces && firewallSNMP.interfaces.length > 0">
                            <div>
                                <table class="table-fixed table-compact">
                                    <thead>
                                        <tr>
                                            <th>Interface</th>
                                            <th>IP Address</th>
                                            <th>Status</th>
                                            <th>RX Rate</th>
                                            <th>TX Rate</th>
                                            <th>Errors</th>
                                            <th>Drops</th>
                                            <th>Utilization</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="iface in firewallSNMP.interfaces" :key="iface.name">
                                            <tr>
                                                <td><strong x-text="iface.name"></strong></td>
                                                <td>
                                                    <span x-show="iface.ip_address" class="text-mono" style="font-size: 0.9em;" x-text="iface.ip_address"></span>
                                                    <span x-show="!iface.ip_address" class="text-muted">‚Äî</span>
                                                </td>
                                                <td>
                                                    <span class="badge" :class="{
                                                                    'badge-success': iface.status === 'up',
                                                                    'badge-error': iface.status === 'down',
                                                                    'badge-warning': iface.status === 'stale' || iface.status === 'unknown' || iface.status === 'admin_down'
                                                                }"
                                                        x-text="iface.status === 'up' ? 'UP' : iface.status === 'down' ? 'DOWN' : iface.status === 'stale' ? 'STALE' : iface.status === 'admin_down' ? 'ADMIN DOWN' : 'UNKNOWN'"></span>
                                                </td>
                                                <td>
                                                    <span x-show="iface.rx_mbps != null && iface.rx_mbps !== undefined"
                                                        x-text="(typeof iface.rx_mbps === 'number' ? iface.rx_mbps : 0).toFixed(2) + ' Mbps'"></span>
                                                    <span x-show="iface.rx_mbps == null || iface.rx_mbps === undefined"
                                                        class="text-muted">‚Äî</span>
                                                </td>
                                                <td>
                                                    <span x-show="iface.tx_mbps != null && iface.tx_mbps !== undefined"
                                                        x-text="(typeof iface.tx_mbps === 'number' ? iface.tx_mbps : 0).toFixed(2) + ' Mbps'"></span>
                                                    <span x-show="iface.tx_mbps == null || iface.tx_mbps === undefined"
                                                        class="text-muted">‚Äî</span>
                                                </td>
                                                <td>
                                                    <template
                                                        x-if="iface.rx_errors !== null && iface.rx_errors !== undefined && iface.tx_errors !== null && iface.tx_errors !== undefined">
                                                        <span
                                                            :class="{ 'text-warn': (iface.rx_errors + iface.tx_errors) > 0, 'text-muted': (iface.rx_errors + iface.tx_errors) === 0 }"
                                                            x-text="(iface.rx_errors + iface.tx_errors).toFixed(1) + '/s'"></span>
                                                    </template>
                                                    <template
                                                        x-if="iface.rx_errors === null || iface.rx_errors === undefined || iface.tx_errors === null || iface.tx_errors === undefined">
                                                        <span class="text-muted">‚Äî</span>
                                                    </template>
                                                </td>
                                                <td>
                                                    <template
                                                        x-if="iface.rx_drops !== null && iface.rx_drops !== undefined && iface.tx_drops !== null && iface.tx_drops !== undefined">
                                                        <span
                                                            :class="{ 'text-warn': (iface.rx_drops + iface.tx_drops) > 0, 'text-muted': (iface.rx_drops + iface.tx_drops) === 0 }"
                                                            x-text="(iface.rx_drops + iface.tx_drops).toFixed(1) + '/s'"></span>
                                                    </template>
                                                    <template
                                                        x-if="iface.rx_drops === null || iface.rx_drops === undefined || iface.tx_drops === null || iface.tx_drops === undefined">
                                                        <span class="text-muted">‚Äî</span>
                                                    </template>
                                                </td>
                                                <td>
                                                    <div
                                                        style="display: flex; align-items: center; gap: var(--space-2);">
                                                        <span x-show="iface.utilization != null"
                                                            :class="{ 'text-warn': iface.utilization > 80, 'text-crit': iface.utilization > 90, 'text-muted': iface.utilization <= 80 }"
                                                            x-text="(iface.utilization || 0).toFixed(1) + '%'"
                                                            :title="iface.speed_mbps ? 'Link speed: ' + iface.speed_mbps + ' Mbps' : ''"></span>
                                                        <span x-show="iface.utilization == null"
                                                            class="text-muted">‚Äî</span>
                                                        <!-- Utilization sparkline -->
                                                        <template
                                                            x-if="iface.utilization_history && iface.utilization_history.length >= 2">
                                                            <svg width="60" height="16"
                                                                style="opacity: 0.5; margin-left: var(--space-1);"
                                                                :title="'Utilization trend (' + iface.utilization_history.length + ' samples)'"
                                                                x-effect="
                                                                            if (iface.utilization_history && iface.utilization_history.length >= 2) {
                                                                                const history = iface.utilization_history;
                                                                                const width = 60;
                                                                                const height = 16;
                                                                                const maxVal = Math.max(...history, 1) || 1;
                                                                                const points = history.map((val, idx) => {
                                                                                    const x = idx * (width / Math.max(history.length - 1, 1));
                                                                                    const y = height - (val / maxVal) * height;
                                                                                    return x + ',' + y;
                                                                                }).join(' ');
                                                                                const polyline = $el.querySelector('polyline');
                                                                                if (polyline) polyline.setAttribute('points', points);
                                                                            }
                                                                        ">
                                                                <polyline fill="none" stroke="currentColor"
                                                                    stroke-width="1" style="color: var(--text-muted);">
                                                                </polyline>
                                                            </svg>
                                                        </template>
                                                        <!-- Saturation hint -->
                                                        <template x-if="iface.saturation_hint">
                                                            <span class="text-muted"
                                                                style="font-size: 0.85em; opacity: 0.7; margin-left: var(--space-2);"
                                                                :title="'Sustained utilization above baseline: ' + iface.saturation_hint"
                                                                x-text="'‚ö† ' + iface.saturation_hint"></span>
                                                        </template>
                                                    </div>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </template>
                        <template x-if="!firewallSNMP.interfaces || firewallSNMP.interfaces.length === 0">
                            <div class="empty-state">
                                <p class="text-muted">No interface data available</p>
                            </div>
                        </template>

                        <!-- Traffic Correlation Status -->
                        <template x-if="firewallSNMP.traffic_correlation && firewallSNMP.traffic_correlation.status">
                            <div
                                style="margin-top: var(--space-4); padding: var(--space-3); background: var(--card-bg); border: 1px solid var(--card-border); border-radius: var(--card-radius);">
                                <div
                                    style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2);">
                                    <span
                                        style="font-size: 0.9em; font-weight: var(--font-weight-semibold); color: var(--text-secondary);">Traffic
                                        Correlation (1h):</span>
                                    <span class="badge" :class="{
                                                    'badge-success': firewallSNMP.traffic_correlation.status === 'aligned',
                                                    'badge-warning': firewallSNMP.traffic_correlation.status === 'flow_heavy' || firewallSNMP.traffic_correlation.status === 'interface_heavy'
                                                }"
                                        x-text="firewallSNMP.traffic_correlation.status === 'aligned' ? 'Aligned' : firewallSNMP.traffic_correlation.status === 'flow_heavy' ? 'Flow-heavy' : firewallSNMP.traffic_correlation.status === 'interface_heavy' ? 'Interface-heavy' : 'Unknown'"></span>
                                </div>
                                <template x-if="firewallSNMP.traffic_correlation.hint">
                                    <p style="font-size: 0.85em; color: var(--text-muted); margin: 0;"
                                        x-text="firewallSNMP.traffic_correlation.hint"></p>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Gateway Status -->
                <template x-if="firewallSNMP.gateway && firewallSNMP.gateway.ip">
                    <div class="card">
                        <h2>
                            <div class="card-title-content">
                                <span class="title-icon">üåê</span>
                                <span>Default Gateway</span>
                            </div>
                        </h2>
                        <div class="widget-body">
                            <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span class="text-secondary">Gateway IP:</span>
                                    <span class="text-mono" x-text="firewallSNMP.gateway.ip"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span class="text-secondary">Status:</span>
                                    <span class="badge"
                                        :class="{
                                            'badge-success': firewallSNMP.gateway.status === 'up',
                                            'badge-error': firewallSNMP.gateway.status === 'down',
                                            'badge-warning': firewallSNMP.gateway.status === 'unknown'
                                        }"
                                        x-text="firewallSNMP.gateway.status === 'up' ? 'REACHABLE' : firewallSNMP.gateway.status === 'down' ? 'UNREACHABLE' : 'UNKNOWN'"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span class="text-secondary">Latency:</span>
                                    <span :class="{
                                        'text-ok': firewallSNMP.gateway.latency_ms !== null && firewallSNMP.gateway.latency_ms < 10,
                                        'text-warn': firewallSNMP.gateway.latency_ms !== null && firewallSNMP.gateway.latency_ms >= 10 && firewallSNMP.gateway.latency_ms < 50,
                                        'text-crit': firewallSNMP.gateway.latency_ms !== null && firewallSNMP.gateway.latency_ms >= 50,
                                        'text-muted': firewallSNMP.gateway.latency_ms === null
                                    }"
                                        x-text="firewallSNMP.gateway.latency_ms !== null ? firewallSNMP.gateway.latency_ms.toFixed(1) + ' ms' : '‚Äî'"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- System Info Panel -->
                <div class="card">
                    <h2>
                        <div class="card-title-content">
                            <span class="title-icon">‚ÑπÔ∏è</span>
                            <span>System Information</span>
                        </div>
                    </h2>
                    <div class="widget-body">
                        <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="text-secondary">Uptime:</span>
                                <span x-text="firewallSNMP.uptime_formatted || 'Unknown'"></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="text-secondary">Last SNMP Poll:</span>
                                <span
                                    x-text="firewallSNMP.last_poll ? timeAgo(firewallSNMP.last_poll) : 'Never'"></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="text-secondary">SNMP Status:</span>
                                <span class="badge"
                                    :class="{ 'badge-success': firewallSNMP.poll_success, 'badge-error': !firewallSNMP.poll_success }"
                                    x-text="firewallSNMP.poll_success ? 'ACTIVE' : 'ERROR'"></span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </template>

    </section>
</div>

<!-- ============================================
             AI ASSISTANT TAB - Ollama Chat Interface
             ============================================ -->