<div x-show="activeTab === 'security'" :style="activeTab === 'security' ? 'display:block' : 'display:none'"
    id="security-tab" role="tabpanel" aria-labelledby="security-tab-btn" tabindex="0">
    <!-- ============================================
             SECURITY CENTER
             ============================================ -->
    <section id="section-security" class="scroll-section mb-6">
        <!-- Security Summary Stats -->
        <div class="grid mb-6 grid-auto-fit" style="margin-bottom: var(--space-6) !important;">
            <div class="card stat-box">
                <div class="value text-white" x-text="(threatActivityTimeline.total_threats || 0).toLocaleString()">
                </div>
                <div class="label">Threats</div>
            </div>
            <div class="card stat-box">
                <div class="value text-white" x-text="(threatActivityTimeline.period_total || 0).toLocaleString()">
                </div>
                <div class="label">Blocks</div>
            </div>
            <div class="card stat-box">
                <div class="value text-white" x-text="(threatActivityTimeline.total_matches || 0).toLocaleString()">
                </div>
                <div class="label">Matches</div>
            </div>
            <div class="card stat-box">
                <div class="value text-white"
                    x-text="(threatActivityTimeline.total_range_alerts || 0).toLocaleString()"></div>
                <div class="label">Alerts</div>
            </div>
        </div>

        <!-- Threat Activity Timeline - Full Width -->
        <section id="section-threat-activity-timeline" class="scroll-section" style="margin-bottom: var(--space-6);">
            {% call widget_card('threatActivityTimeline', 'Threat Activity Timeline', 'üìà',
            card_class='wide-card', show_spinner=True) %}
            <!-- Control Bar Removed (Redundant range/export) -->

            <!-- Stats Summary -->
            <div class="timeline-stats-summary">
                <div class="timeline-stat-box">
                    <div class="stat-label">Avg Threats/hr</div>
                    <div class="stat-value" style="color: var(--neon-red);"
                        x-text="(threatActivityTimeline.avg_threat_rate || 0)"></div>
                </div>
                <div class="timeline-stat-box">
                    <div class="stat-label">Peak Threats/hr</div>
                    <div class="stat-value" style="color: var(--neon-red); opacity: 0.8;"
                        x-text="(threatActivityTimeline.peak_threat_rate || 0)"></div>
                </div>
                <div class="timeline-stat-box">
                    <div class="stat-label">Match Rate (%)</div>
                    <div class="stat-value" style="color: var(--neon-purple);"
                        x-text="(threatActivityTimeline.avg_match_rate || 0) + '%'"></div>
                </div>
                <div class="timeline-stat-box">
                    <div class="stat-label">Avg Blocks/hr</div>
                    <div class="stat-value" style="color: var(--neon-green);"
                        x-text="(threatActivityTimeline.avg_block_rate || 0)"></div>
                </div>
                <div class="timeline-stat-box">
                    <div class="stat-label">Peak Blocks/hr</div>
                    <div class="stat-value" style="color: var(--neon-green); opacity: 0.8;"
                        x-text="(threatActivityTimeline.peak_block_rate || 0)"></div>
                </div>
                <div class="timeline-stat-box">
                    <div class="stat-label"
                        x-text="'Total Blocks (' + (threatActivityTimeline.period_label || 'Period') + ')'"></div>
                    <div class="stat-value" style="color: var(--neon-cyan);"
                        x-text="threatActivityTimeline.period_total || 0"></div>
                </div>
            </div>

            <!-- Chart -->
            <div class="chart-wrapper" style="height: 200px; margin-bottom: var(--space-2);"
                x-show="threatActivityTimeline.timeline && threatActivityTimeline.timeline.length > 0">
                <canvas id="threatActivityTimelineChart"></canvas>
            </div>

            <!-- Empty State -->
            <div x-show="!threatActivityTimeline.loading && (!threatActivityTimeline.timeline || threatActivityTimeline.timeline.length === 0)"
                class="empty-state">
                <div style="font-size: 32px; margin-bottom: var(--space-2);" aria-hidden="true">üìà
                </div>
                <p
                    style="font-size: var(--text-base); margin-bottom: var(--space-1); font-weight: var(--font-weight-semibold);">
                    No Threat Activity Data</p>
                <p style="font-size: var(--text-xs); color: var(--text-tertiary); max-width: 400px; margin: 0 auto;">
                    Timeline data populates as security alerts are generated or firewall blocks are detected.
                </p>
            </div>
            {% endcall %}
        </section>

        <!-- Security Actions -->


        <!-- Security Widgets Grid -->
        <div class="security-grid">

            <!-- Security Coverage & Protection Widget -->
            <template x-if="isVisible('securityObservability')">
                {% call widget_card('securityObservability', 'Security Coverage & Protection', 'üõ°Ô∏è',
                show_spinner=True,
                card_class="security-coverage-card") %}

                <!-- Protection Status Section -->
                <div class="coverage-section protection-status">
                    <div class="coverage-row">
                        <div class="coverage-item">
                            <span class="coverage-icon"
                                :class="(securityObservability.firewall?.blocks > 0 || securityObservability.firewall?.threats_blocked > 0) ? 'status-ok' : 'status-unknown'">
                                <template
                                    x-if="securityObservability.firewall?.blocks > 0 || securityObservability.firewall?.threats_blocked > 0">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                </template>
                                <template
                                    x-if="!(securityObservability.firewall?.blocks > 0 || securityObservability.firewall?.threats_blocked > 0)">
                                    <span>‚Äî</span>
                                </template>
                            </span>
                            <div class="coverage-detail">
                                <span class="coverage-label">Firewall</span>
                                <span class="coverage-value"
                                    x-text="(securityObservability.firewall?.blocks > 0 || securityObservability.firewall?.threats_blocked > 0) ? 'Active' : 'Unknown'"></span>
                            </div>
                        </div>
                        <div class="coverage-item">
                            <span class="coverage-icon status-info">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                </svg>
                            </span>
                            <div class="coverage-detail">
                                <span class="coverage-label"
                                    x-text="'Threats Blocked (' + (threatActivityTimeline.period_label || 'Period') + ')'">Threats
                                    Blocked</span>
                                <span class="coverage-value"
                                    x-text="(threatActivityTimeline.period_total || 0).toLocaleString()"></span>
                            </div>
                        </div>
                        <div class="coverage-item">
                            <span class="coverage-icon"
                                :class="(activeAlertsCount || 0) > 0 ? 'status-warn' : 'status-ok'">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                                </svg>
                            </span>
                            <div class="coverage-detail">
                                <span class="coverage-label">Active Alerts</span>
                                <span class="coverage-value" x-text="activeAlertsCount || 0"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Coverage Quality Section -->
                <div class="coverage-section coverage-quality">
                    <div class="coverage-header">
                        <span class="coverage-section-title">Detection Coverage</span>
                    </div>
                    <div class="coverage-row">
                        <div class="coverage-item wide">
                            <span class="coverage-icon status-info">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="2" y1="12" x2="22" y2="12"></line>
                                    <path
                                        d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                                    </path>
                                </svg>
                            </span>
                            <div class="coverage-detail">
                                <span class="coverage-label">Threat Feeds</span>
                                <span class="coverage-value">
                                    <span x-text="feedHealth.summary?.ok || 0"></span>
                                    <span class="coverage-separator">/</span>
                                    <span x-text="feedHealth.summary?.total || 0"></span>
                                </span>
                            </div>
                        </div>
                        <div class="coverage-item wide">
                            <span class="coverage-icon status-info">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </span>
                            <div class="coverage-detail">
                                <span class="coverage-label">Blocklist IPs</span>
                                <span class="coverage-value"
                                    x-text="(feedHealth.summary?.total_ips || 0).toLocaleString()"></span>
                            </div>
                        </div>
                    </div>
                    <!-- Coverage note (shown only when coverage is reduced) -->
                    <template x-if="feedHealth.summary?.ok < feedHealth.summary?.total">
                        <div class="coverage-note">
                            <span class="note-icon">‚ÑπÔ∏è</span>
                            <span class="note-text">
                                <span x-text="(feedHealth.summary?.total || 0) - (feedHealth.summary?.ok || 0)"></span>
                                feed<span
                                    x-text="((feedHealth.summary?.total || 0) - (feedHealth.summary?.ok || 0)) === 1 ? '' : 's'"></span>
                                unavailable ‚Äî detection may be reduced
                            </span>
                        </div>
                    </template>
                </div>

                <!-- Activity Hints Section (shown only when relevant) -->
                <template
                    x-if="securityObservability.exposure_signals && securityObservability.exposure_signals.length > 0">
                    <div class="coverage-section activity-hints">
                        <div class="coverage-header">
                            <span class="coverage-section-title">Activity</span>
                        </div>
                        <div class="activity-row">
                            <span class="activity-icon">üìä</span>
                            <span class="activity-text">Elevated attack rate vs. baseline</span>
                        </div>
                    </div>
                </template>

                {% endcall %}
            </template>

            <!-- Alert History Widget -->
            <template x-if="isVisible('alertHistory')">
                {% call widget_card('alertHistory', 'Alert History', '', show_spinner=True,
                title_x_text="'Alert History'",
                period_x_text="threatActivityTimeline.period_label || '24h'")
                %}
                <!-- Alert Filters -->
                <div class="alert-filters">
                    <select x-model="alertFilter.severity" class="filter-select" aria-label="Filter alerts by severity">
                        <option value="all">All Severities</option>
                        <option value="critical">Critical</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                    <select x-model="alertFilter.type" class="filter-select" aria-label="Filter alerts by type">
                        <option value="all">All Types</option>
                        <option value="threat_ip">Threat IP</option>
                        <option value="port_scan">Port Scan</option>
                        <option value="brute_force">Brute Force</option>
                        <option value="data_exfil">Data Exfil</option>
                        <option value="dns_tunneling">DNS Tunneling</option>
                        <option value="lateral_movement">Lateral Movement</option>
                        <option value="suspicious_port">Suspicious Port</option>
                        <option value="large_transfer">Large Transfer</option>
                        <option value="off_hours">Off-Hours</option>

                    </select>
                </div>
                <div class="alert-summary">
                    <span class="alert-badge critical" x-show="activeAlertsBySeverity?.critical > 0"><span
                            x-text="activeAlertsBySeverity?.critical || 0"></span>
                        critical</span>
                    <span class="alert-badge high" x-show="activeAlertsBySeverity?.high > 0">
                        <span x-text="activeAlertsBySeverity?.high || 0"></span> high</span>
                    <span class="alert-badge medium" x-show="activeAlertsBySeverity?.medium > 0">
                        <span x-text="activeAlertsBySeverity?.medium || 0"></span>
                        medium</span>
                    <span class="alert-badge low" x-show="activeAlertsBySeverity?.low > 0">
                        <span x-text="activeAlertsBySeverity?.low || 0"></span> low</span>
                    <span class="text-muted">Total: <span x-text="activeAlertsCount || 0"></span></span>
                </div>
                <div class="alert-list">
                    <template x-for="(a, idx) in filteredAlerts.slice(0, 10)" :key="idx">
                        <div class="alert-row" :class="'severity-row-' + a.severity">
                            <div class="alert-time" x-text="a.time_ago"></div>
                            <div class="alert-info">
                                <span class="alert-type-badge"
                                    :class="'cat-' + (a.category || a.type || 'unknown').toLowerCase()"
                                    x-text="a.type || 'alert'"></span>
                                <span class="alert-msg" :title="a.msg"
                                    x-text="a.msg.replace(/^[^:]+:\s+/, '').replace(/\s*\([^)]+\)$/, '')"></span>
                            </div>
                            <div class="alert-severity" :class="'sev-' + a.severity" x-text="a.severity"></div>
                        </div>
                    </template>
                    <template x-if="filteredAlerts.length === 0">
                        <div class="alert-empty"
                            x-text="alertFilter.severity !== 'all' || alertFilter.type !== 'all' ? 'No matching alerts' : 'No alerts in past ' + (threatActivityTimeline.period_label || '24h')">
                        </div>
                    </template>
                </div>
                {% endcall %}
            </template>

            <template x-if="isVisible('threatsByCountry')">
                {% call widget_card('threatsByCountry', 'Detections by Country', 'üåç',
                show_spinner=True,
                title_x_text="'DETECTIONS BY COUNTRY'",
                period_x_text="threatActivityTimeline.period_label || '24h'") %}
                <div class="country-threat-list">
                    <template x-if="threatsByCountry.countries && threatsByCountry.countries.length > 0">
                        <div>
                            <div class="text-85 text-muted mb-2">
                                <span x-text="threatsByCountry.total_countries || 0"></span>
                                countries ‚Äî threats & blocks detected
                                <template x-if="threatsByCountry.has_fw_data">
                                    <span> ¬∑ <span class="text-green" x-text="threatsByCountry.total_blocked"></span>
                                        blocked</span>
                                </template>
                            </div>
                            <template x-for="(c, idx) in (threatsByCountry.countries || []).slice(0, 8)"
                                :key="c.country_code">
                                <div class="country-threat-item">
                                    <span class="country-flag" x-text="c.country_code"></span>
                                    <span class="country-name" x-text="c.country_name"></span>
                                    <span class="country-count">
                                        <span x-text="c.threat_count"></span>
                                        <template x-if="c.blocked > 0">
                                            <span style="display: inline-flex; align-items: center;">
                                                <span class="text-muted"
                                                    style="margin: 0 8px; font-size: 0.9em; opacity: 0.3;">/</span>
                                                <span class="text-green" style="font-weight: 600;"
                                                    x-text="c.blocked"></span>
                                            </span>
                                        </template>
                                    </span>
                                </div>
                            </template>
                        </div>
                    </template>
                    <template x-if="!threatsByCountry.countries || threatsByCountry.countries.length === 0">
                        <div class="empty-state-compact">
                            <span class="empty-icon">üåç</span>
                            <span>No geo-located threats</span>
                        </div>
                    </template>
                </div>
                {% endcall %}
            </template>

            <!-- Threat Detections - MOVED TO FIREWALL TAB -->

            <!-- Feed Health -->
            <template x-if="isVisible('feedHealth')">
                {% call widget_card('feedHealth', 'Feed Health', 'üì°', show_spinner=True,
                period_x_text="feedHealth.summary?.last_refresh || 'never'") %}
                <!-- Summary Bar -->
                <div class="feed-summary-bar">
                    <div class="feed-stat">
                        <span class="feed-stat-value text-green" x-text="feedHealth.summary?.ok || 0"></span>
                        <span class="feed-stat-label">OK</span>
                    </div>
                    <div class="feed-stat-divider">/</div>
                    <div class="feed-stat">
                        <span class="feed-stat-value" x-text="feedHealth.summary?.total || 0"></span>
                        <span class="feed-stat-label">Feeds</span>
                    </div>
                    <div class="feed-stat-sep">¬∑</div>
                    <div class="feed-stat">
                        <span class="feed-stat-value text-white"
                            x-text="(feedHealth.summary?.total_ips || 0).toLocaleString()"></span>
                        <span class="feed-stat-label">IPs</span>
                    </div>
                </div>
                <!-- Feed List (Full Width) -->
                <div class="feed-list-full">
                    <template x-for="(f, idx) in feedHealth.feeds" :key="f.name + idx">
                        <div class="feed-item" :class="{ 'feed-error': f.status !== 'ok' }">
                            <span class="feed-status-dot" :class="f.status"></span>
                            <span class="feed-name-full" x-text="f.name" :title="f.name"></span>
                            <span class="feed-ips-count" x-text="(f.ips || 0).toLocaleString()"></span>
                            <span class="feed-category-tag" :class="'cat-' + (f.category || 'unknown').toLowerCase()"
                                x-text="f.category"></span>
                        </div>
                    </template>
                    <template x-if="!feedHealth.feeds || feedHealth.feeds.length === 0">
                        <div class="feed-empty">
                            <span>üì° No feed data yet</span>
                        </div>
                    </template>
                </div>
                {% endcall %}
            </template>

            <!-- Top Malicious Ports -->
            {% call widget_card('maliciousPorts', 'Top Malicious Ports', 'üîí', show_spinner=True,
            title_x_text="'TOP MALICIOUS PORTS'",
            period_x_text="threatActivityTimeline.period_label || '24h'") %}
            <div class="text-9 text-muted mb-2">
                <template x-if="maliciousPorts.has_syslog">
                    <span>Ports targeted by threats + blocked by firewall</span>
                </template>
                <template x-if="!maliciousPorts.has_syslog">
                    <span>Ports most frequently seen in threat traffic</span>
                </template>
            </div>
            <div style="max-height: 285px; overflow-y: auto;">
                <table class="table-fixed table-compact">
                    <thead>
                        <tr>
                            <th>Port</th>
                            <th>FW Blocked</th>
                            <th>Traffic</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(p, i) in maliciousPorts.ports.slice(0, 20)" :key="p.port + '-' + i">
                            <tr>
                                <td>
                                    <strong class="text-cyan" x-text="p.port"></strong>
                                    <template x-if="p.suspicious"><span>
                                            ‚ö†</span></template>
                                    <div class="text-8 text-muted" x-text="p.service || ''">
                                    </div>
                                </td>
                                <td>
                                    <template x-if="p.blocked > 0">
                                        <span class="text-green"><span x-text="p.blocked"></span></span>
                                    </template>
                                    <template x-if="!p.blocked || p.blocked === 0">
                                        <span class="text-muted">‚Äî</span>
                                    </template>
                                    <template x-if="p.unique_attackers > 1">
                                        <div class="text-75 text-muted" x-text="p.unique_attackers + ' IPs'"></div>
                                    </template>
                                </td>
                                <td>
                                    <template
                                        x-if="p.bytes_fmt || (p.netflow_bytes || 0) > 0 || (p.netflow_flows || 0) > 0">
                                        <div>
                                            <strong class="text-green"
                                                x-text="p.bytes_fmt || (p.netflow_bytes ? fmtBytes(p.netflow_bytes) : '0 B')"></strong>
                                            <div class="text-8 text-muted" x-text="(p.netflow_flows || 0) + ' flows'">
                                            </div>
                                        </div>
                                    </template>
                                    <template
                                        x-if="!p.bytes_fmt && (p.netflow_bytes || 0) === 0 && (p.netflow_flows || 0) === 0">
                                        <span class="text-muted">‚Äî</span>
                                    </template>
                                </td>
                            </tr>
                        </template>
                        <template x-if="!maliciousPorts.ports || maliciousPorts.ports.length===0">
                            <tr>
                                <td colspan="3" class="text-muted text-center">
                                    No
                                    malicious port data</td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
            {% endcall %}





            <!-- Top Threat IPs Widget -->
            <template x-if="isVisible('topThreatIPs')">
                {% call widget_card('topThreatIPs', 'Top Threat IPs', 'üéØ', show_spinner=True,
                title_x_text="'TOP THREAT IPS'",
                period_x_text="threatActivityTimeline.period_label || '24h'")
                %}
                <div class="threat-ips-list">
                    <template x-for="(ip, idx) in (topThreatIPs.ips || []).slice(0, 5)" :key="ip.ip">
                        <div class="threat-ip-item" @click="openEventDetails(ip, 'threat')" style="cursor: pointer;">
                            <div class="threat-ip-rank" x-text="idx + 1"></div>
                            <div class="threat-ip-info">
                                <span class="threat-ip-addr" x-text="ip.ip"></span>
                                <span class="threat-ip-meta">
                                    <span class="badge" :class="'cat-' + (ip.category || 'unknown').toLowerCase()"
                                        x-text="ip.category || 'Unknown'"></span>
                                    <span :title="ip.country_name || ''"
                                        x-text="(ip.flag || '') + ' ' + (ip.country || '--')"></span>
                                </span>
                            </div>
                            <div class="threat-ip-hits">
                                <span class="hits-value" x-text="ip.hits"></span>
                                <span class="hits-label">hits</span>
                            </div>
                        </div>
                    </template>
                    <template x-if="!topThreatIPs.ips || topThreatIPs.ips.length === 0">
                        <div class="empty-state-compact">
                            <span class="empty-icon">‚úÖ</span>
                            <span>No threat IPs detected</span>
                        </div>
                    </template>
                </div>
                {% endcall %}
            </template>

            <!-- MITRE ATT&CK Coverage Widget -->
            <template x-if="isVisible('mitreHeatmap')">
                {% call widget_card('mitreHeatmap', 'Detected Techniques', 'üéØ',
                show_spinner=True,
                title_x_text="'DETECTED TECHNIQUES'",
                period_x_text="threatActivityTimeline.period_label || '24h'") %}
                <div x-show="mitreHeatmap.techniques && mitreHeatmap.techniques.length > 0">
                    <div
                        style="display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-3);">
                        <div style="font-size: var(--text-xl); font-weight: var(--font-weight-bold); color: var(--neon-red);"
                            x-text="mitreHeatmap.total_techniques || 0"></div>
                        <div style="font-size: var(--text-sm); color: var(--text-secondary);">
                            Techniques Detected</div>
                    </div>
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: var(--space-2); max-height: 200px; overflow-y: auto;">
                        <template x-for="technique in mitreHeatmap.techniques.slice(0, 12)" :key="technique.id">
                            <div class="card"
                                style="padding: var(--space-1) var(--space-2); text-align: center; cursor: pointer; transition: all var(--motion-base);"
                                :style="'background: rgba(255, 0, 60, ' + Math.min(0.1 + (technique.count / 10) * 0.3, 0.4) + '); border: 1px solid rgba(255, 0, 60, ' + Math.min(0.2 + (technique.count / 10) * 0.3, 0.6) + ');'"
                                :title="technique.name + ' - ' + technique.count + ' detections'">
                                <div style="font-size: var(--text-xs); color: var(--neon-red); font-weight: var(--font-weight-bold);"
                                    x-text="technique.id"></div>
                                <div style="font-size: 10px; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"
                                    x-text="technique.name"></div>
                                <div style="font-size: var(--text-sm); color: var(--text-primary); font-weight: var(--font-weight-semibold);"
                                    x-text="technique.count"></div>
                            </div>
                        </template>
                    </div>
                    <div x-show="Object.keys(mitreHeatmap.by_tactic || {}).length > 0"
                        style="margin-top: var(--space-3); padding-top: var(--space-2); border-top: 1px solid rgba(255, 255, 255, 0.1);">
                        <div
                            style="font-size: var(--text-xs); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-1); color: var(--text-secondary);">
                            By Tactic:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: var(--space-1);">
                            <template x-for="(techniques, tactic) in (mitreHeatmap.by_tactic || {})" :key="tactic">
                                <span class="badge"
                                    style="background: rgba(0, 243, 255, 0.15); color: var(--neon-cyan); padding: 2px 6px; font-size: 10px;">
                                    <span x-text="tactic"></span>: <strong
                                        x-text="techniques.reduce((sum, t) => sum + t.count, 0)"></strong>
                                </span>
                            </template>
                        </div>
                    </div>
                </div>
                <div x-show="!mitreHeatmap.loading && (!mitreHeatmap.techniques || mitreHeatmap.techniques.length === 0)"
                    class="empty-state-compact">
                    <span class="empty-icon">üéØ</span>
                    <span>No MITRE techniques detected</span>
                </div>
                {% endcall %}
            </template>


            <!-- Protocol Anomalies Widget -->
            <template x-if="isVisible('protocolAnomalies')">
                {% call widget_card('protocolAnomalies', 'Protocol Anomalies', '‚ö°',
                show_spinner=True,
                title_x_text="'PROTOCOL ANOMALIES'",
                period_x_text="threatActivityTimeline.period_label || '24h'") %}
                <div class="anomaly-summary" :class="{ 'has-anomalies': protocolAnomalies.anomaly_count > 0 }">
                    <div x-show="protocolAnomalies.status === 'warming'" class="warming-banner">
                        <span class="warming-icon">‚ö†Ô∏è</span>
                        <span class="warming-text">Baseline Warming (learning phase)</span>
                    </div>
                    <span x-show="protocolAnomalies.status !== 'warming' && protocolAnomalies.anomaly_count > 0"
                        class="text-red">‚ö†Ô∏è
                        <span x-text="protocolAnomalies.anomaly_count"></span> anomalies
                        detected</span>
                    <span x-show="protocolAnomalies.status !== 'warming' && protocolAnomalies.anomaly_count === 0"
                        class="text-green">‚úÖ No
                        anomalies</span>
                </div>
                <div class="protocol-anomaly-list">
                    <template x-for="proto in (protocolAnomalies.protocols || []).slice(0, 6)" :key="proto.protocol">
                        <div class="protocol-anomaly-item" :class="{ 'is-anomaly': proto.is_anomaly }">
                            <span class="proto-name" x-text="proto.protocol"></span>
                            <span class="proto-bytes" x-text="proto.bytes_fmt"></span>
                            <span class="proto-deviation"
                                :class="{ 'deviation-high': proto.deviation > 3, 'deviation-medium': proto.deviation > 1.5 }"
                                x-text="proto.deviation + 'x'"></span>
                        </div>
                    </template>
                </div>
                {% endcall %}
            </template>

        </div> <!-- End security-grid -->



    </section>
</div>

<!-- ============================================
             NETWORK TAB
             ============================================ -->