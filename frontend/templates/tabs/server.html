<div x-show="activeTab === 'server'" :style="activeTab === 'server' ? 'display:block' : 'display:none'" id="server-tab"
    role="tabpanel" aria-labelledby="server-tab-btn" tabindex="0">
    <section id="section-server" class="scroll-section" style="margin-bottom: 32px;">
        <!-- Loading State -->
        <template x-if="serverHealth.loading && !serverHealth.timestamp">
            <div class="empty-state">
                <span>Loading server health data...</span>
            </div>
        </template>

        <!-- Error State -->
        <template x-if="serverHealth.error && !serverHealth.loading">
            <div class="empty-state" style="color: var(--neon-red);">
                <span x-text="serverHealth.error"></span>
            </div>
        </template>

        <!-- Server Health Content -->
        <template x-if="!serverHealth.error || serverHealth.timestamp">
            <div>
                <!-- Row 1: Server Overview (Unified Card) -->
                <div class="card" style="margin-bottom: 16px;">
                    <h2>
                        <div class="card-title-content">
                            <span class="title-icon">üñ•Ô∏è</span>
                            <span>Server Overview</span>
                        </div>
                        <div class="card-actions">
                            <span class="server-stat-badge" :class="{
                                'badge-success': (serverHealth.cpu?.percent || 0) < 70 && (serverHealth.memory?.percent || 0) < 80 && (serverHealth.disk?.root?.percent_used || 0) < 80,
                                'badge-warning': (serverHealth.cpu?.percent || 0) >= 70 || (serverHealth.memory?.percent || 0) >= 80 || (serverHealth.disk?.root?.percent_used || 0) >= 80,
                                'badge-error': (serverHealth.cpu?.percent || 0) >= 90 || (serverHealth.memory?.percent || 0) >= 90 || (serverHealth.disk?.root?.percent_used || 0) >= 90
                            }" x-text="(serverHealth.cpu?.percent || 0) >= 90 || (serverHealth.memory?.percent || 0) >= 90 || (serverHealth.disk?.root?.percent_used || 0) >= 90 ? 'CRITICAL' : ((serverHealth.cpu?.percent || 0) >= 70 || (serverHealth.memory?.percent || 0) >= 80 || (serverHealth.disk?.root?.percent_used || 0) >= 80 ? 'ELEVATED' : 'HEALTHY')"></span>
                        </div>
                    </h2>
                    <div class="widget-body" style="padding: 16px 20px;">
                        <!-- System Identity Row -->
                        <div style="display: flex; flex-wrap: wrap; gap: 24px; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div style="display: flex; gap: 8px; align-items: baseline;">
                                <span style="color: var(--text-secondary); font-size: 0.85em;">Hostname:</span>
                                <span style="color: var(--text-primary); font-weight: 500;" x-text="serverHealth.system?.hostname || '‚Äî'"></span>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: baseline;">
                                <span style="color: var(--text-secondary); font-size: 0.85em;">Uptime:</span>
                                <span style="color: var(--text-primary); font-weight: 500;" x-text="serverHealth.system?.uptime_formatted || '‚Äî'"></span>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: baseline;">
                                <span style="color: var(--text-secondary); font-size: 0.85em;">OS:</span>
                                <span style="color: var(--text-primary); font-size: 0.9em;" x-text="serverHealth.system?.os_info || '‚Äî'"></span>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: baseline;">
                                <span style="color: var(--text-secondary); font-size: 0.85em;">Boot:</span>
                                <span style="color: var(--text-primary); font-size: 0.9em;" x-text="serverHealth.system?.boot_time_formatted || '‚Äî'"></span>
                            </div>
                        </div>

                        <!-- Resource Gauges Row -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
                            <!-- CPU Gauge -->
                            <div style="text-align: center;">
                                <div style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 8px;">CPU</div>
                                <div style="font-size: 2em; font-weight: 600; margin-bottom: 8px;" :class="{
                                    'text-green': (serverHealth.cpu?.percent || 0) < 70,
                                    'text-yellow': (serverHealth.cpu?.percent || 0) >= 70 && (serverHealth.cpu?.percent || 0) < 90,
                                    'text-red': (serverHealth.cpu?.percent || 0) >= 90
                                }" x-text="serverHealth.cpu?.percent !== undefined ? serverHealth.cpu.percent + '%' : '‚Äî'"></div>
                                <div class="server-stat-progress" style="height: 8px; margin-bottom: 8px;">
                                    <div class="server-stat-progress-bar" :class="{
                                        'warning': (serverHealth.cpu?.percent || 0) >= 70 && (serverHealth.cpu?.percent || 0) < 90,
                                        'error': (serverHealth.cpu?.percent || 0) >= 90
                                    }" :style="'width: ' + (serverHealth.cpu?.percent || 0) + '%'"></div>
                                </div>
                                <div style="font-size: 0.8em; color: var(--text-secondary);">
                                    Load: <span x-text="serverHealth.cpu?.load_1min || '‚Äî'"></span> / <span x-text="serverHealth.cpu?.load_5min || '‚Äî'"></span> / <span x-text="serverHealth.cpu?.load_15min || '‚Äî'"></span>
                                </div>
                            </div>

                            <!-- Memory Gauge -->
                            <div style="text-align: center;">
                                <div style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 8px;">Memory</div>
                                <div style="font-size: 2em; font-weight: 600; margin-bottom: 8px;" :class="{
                                    'text-green': (serverHealth.memory?.percent || 0) < 80,
                                    'text-yellow': (serverHealth.memory?.percent || 0) >= 80 && (serverHealth.memory?.percent || 0) < 90,
                                    'text-red': (serverHealth.memory?.percent || 0) >= 90
                                }" x-text="serverHealth.memory?.percent !== undefined ? serverHealth.memory.percent + '%' : '‚Äî'"></div>
                                <div class="server-stat-progress" style="height: 8px; margin-bottom: 8px;">
                                    <div class="server-stat-progress-bar" :class="{
                                        'warning': (serverHealth.memory?.percent || 0) >= 80 && (serverHealth.memory?.percent || 0) < 90,
                                        'error': (serverHealth.memory?.percent || 0) >= 90
                                    }" :style="'width: ' + (serverHealth.memory?.percent || 0) + '%'"></div>
                                </div>
                                <div style="font-size: 0.8em; color: var(--text-secondary);">
                                    Used: <span x-text="serverHealth.memory?.used_gb ? serverHealth.memory.used_gb + ' GB' : '‚Äî'"></span> / <span x-text="serverHealth.memory?.total_gb ? serverHealth.memory.total_gb + ' GB' : '‚Äî'"></span>
                                </div>
                            </div>

                            <!-- Disk Gauge -->
                            <div style="text-align: center;">
                                <div style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 8px;">Disk</div>
                                <div style="font-size: 2em; font-weight: 600; margin-bottom: 8px;" :class="{
                                    'text-green': (serverHealth.disk?.root?.percent_used || 0) < 80,
                                    'text-yellow': (serverHealth.disk?.root?.percent_used || 0) >= 80 && (serverHealth.disk?.root?.percent_used || 0) < 90,
                                    'text-red': (serverHealth.disk?.root?.percent_used || 0) >= 90
                                }" x-text="serverHealth.disk?.root?.percent_used !== undefined ? serverHealth.disk.root.percent_used + '%' : '‚Äî'"></div>
                                <div class="server-stat-progress" style="height: 8px; margin-bottom: 8px;">
                                    <div class="server-stat-progress-bar" :class="{
                                        'warning': (serverHealth.disk?.root?.percent_used || 0) >= 80 && (serverHealth.disk?.root?.percent_used || 0) < 90,
                                        'error': (serverHealth.disk?.root?.percent_used || 0) >= 90
                                    }" :style="'width: ' + (serverHealth.disk?.root?.percent_used || 0) + '%'"></div>
                                </div>
                                <div style="font-size: 0.8em; color: var(--text-secondary);">
                                    Used: <span x-text="serverHealth.disk?.root?.used_gb ? serverHealth.disk.root.used_gb + ' GB' : '‚Äî'"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row 2: Resource History Charts -->
                <div class="card" style="margin-bottom: 16px;">
                    <h2>
                        <div class="card-title-content">
                            <span class="title-icon">üìä</span>
                            <span>Resource History (1h)</span>
                        </div>
                        <div class="card-actions">
                            <span style="font-size: 0.75em; color: var(--text-secondary);" x-text="resourceHistory.history?.length ? resourceHistory.history.length + ' samples' : 'Collecting...'"></span>
                        </div>
                    </h2>
                    <div class="widget-body" style="padding: 16px 20px;">
                        <div x-show="resourceHistory.loading && !resourceHistory.history?.length" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <span>Loading resource history...</span>
                        </div>
                        <div x-show="!resourceHistory.loading || resourceHistory.history?.length > 0">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px;">
                                <!-- CPU History Chart -->
                                <div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                        <span style="font-size: 0.9em; color: var(--text-secondary);">CPU Usage</span>
                                        <span style="font-size: 0.8em; color: var(--text-muted);">Peak: <span x-text="resourceHistory.cpu_peak !== null ? resourceHistory.cpu_peak + '%' : '‚Äî'"></span></span>
                                    </div>
                                    <div style="height: 80px; background: rgba(0,0,0,0.2); border-radius: 4px; position: relative; overflow: hidden;">
                                        <canvas x-ref="cpuHistoryChart" style="width: 100%; height: 100%;"></canvas>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                                        <span style="font-size: 0.75em; color: var(--text-muted);">1h ago</span>
                                        <span style="font-size: 0.8em; color: var(--text-primary);">Current: <span x-text="resourceHistory.history?.length ? (resourceHistory.history[resourceHistory.history.length-1]?.cpu_percent ?? '‚Äî') + '%' : '‚Äî'"></span></span>
                                        <span style="font-size: 0.75em; color: var(--text-muted);">Now</span>
                                    </div>
                                </div>

                                <!-- Memory History Chart -->
                                <div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                        <span style="font-size: 0.9em; color: var(--text-secondary);">Memory Usage</span>
                                        <span style="font-size: 0.8em; color: var(--text-muted);">Peak: <span x-text="resourceHistory.mem_peak !== null ? resourceHistory.mem_peak + '%' : '‚Äî'"></span></span>
                                    </div>
                                    <div style="height: 80px; background: rgba(0,0,0,0.2); border-radius: 4px; position: relative; overflow: hidden;">
                                        <canvas x-ref="memHistoryChart" style="width: 100%; height: 100%;"></canvas>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                                        <span style="font-size: 0.75em; color: var(--text-muted);">1h ago</span>
                                        <span style="font-size: 0.8em; color: var(--text-primary);">Current: <span x-text="resourceHistory.history?.length ? (resourceHistory.history[resourceHistory.history.length-1]?.mem_percent ?? '‚Äî') + '%' : '‚Äî'"></span></span>
                                        <span style="font-size: 0.75em; color: var(--text-muted);">Now</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div x-show="resourceHistory.history?.length < 5" style="margin-top: 12px; padding: 8px 12px; background: rgba(255,180,0,0.1); border-radius: 4px; border-left: 3px solid var(--signal-warn);">
                            <span style="font-size: 0.8em; color: var(--text-secondary);">Resource history is warming up. Full data available after ~5 minutes.</span>
                        </div>
                    </div>
                </div>

                <!-- Row 3: Data Pipeline Status -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
                    <!-- NetFlow Card -->
                    <div class="card">
                        <h2 style="font-size: 0.9em; padding: 12px 16px;">
                            <div class="card-title-content">
                                <span class="title-icon">üì•</span>
                                <span>NetFlow</span>
                            </div>
                            <div class="card-actions">
                                <span class="server-stat-badge" :class="{
                                    'badge-success': serverHealth.netflow?.available,
                                    'badge-error': serverHealth.netflow && !serverHealth.netflow.available
                                }" style="font-size: 0.7em;" x-text="serverHealth.netflow?.available ? 'ONLINE' : 'OFFLINE'"></span>
                            </div>
                        </h2>
                        <div class="widget-body" style="padding: 12px 16px;">
                            <div style="font-size: 0.85em; color: var(--text-secondary); display: flex; flex-direction: column; gap: 6px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Files:</span>
                                    <span style="color: var(--text-primary); font-weight: 500;" x-text="serverHealth.netflow?.files_count !== undefined ? serverHealth.netflow.files_count.toLocaleString() : '‚Äî'"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Rate:</span>
                                    <span style="color: var(--text-primary); font-weight: 500;" x-text="ingestionRates?.rates?.netflow_eps !== undefined ? ingestionRates.rates.netflow_eps + ' /s' : '‚Äî'"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filterlog (514) Card -->
                    <div class="card">
                        <h2 style="font-size: 0.9em; padding: 12px 16px;">
                            <div class="card-title-content">
                                <span class="title-icon">üìù</span>
                                <span>Filterlog (514)</span>
                            </div>
                            <div class="card-actions">
                                <span class="server-stat-badge" :class="{
                                    'badge-success': serverHealth.syslog?.active,
                                    'badge-error': serverHealth.syslog && !serverHealth.syslog.active
                                }" style="font-size: 0.7em;" x-text="serverHealth.syslog?.active ? 'ACTIVE' : 'INACTIVE'"></span>
                            </div>
                        </h2>
                        <div class="widget-body" style="padding: 12px 16px;">
                            <div style="font-size: 0.85em; color: var(--text-secondary); display: flex; flex-direction: column; gap: 6px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Received:</span>
                                    <span style="color: var(--text-primary); font-weight: 500;" x-text="serverHealth.syslog?.received ? serverHealth.syslog.received.toLocaleString() : '0'"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Parsed:</span>
                                    <span style="color: var(--text-primary); font-weight: 500;" x-text="serverHealth.syslog?.parsed ? serverHealth.syslog.parsed.toLocaleString() : '0'"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Errors:</span>
                                    <span style="color: var(--text-primary); font-weight: 500;" x-text="serverHealth.syslog?.errors ? serverHealth.syslog.errors.toLocaleString() : '0'"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Rate:</span>
                                    <span style="color: var(--text-primary); font-weight: 500;" x-text="ingestionRates?.rates?.syslog_eps !== undefined ? ingestionRates.rates.syslog_eps + ' /s' : '‚Äî'"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Firewall (515) Card -->
                    <div class="card">
                        <h2 style="font-size: 0.9em; padding: 12px 16px;">
                            <div class="card-title-content">
                                <span class="title-icon">üì°</span>
                                <span>Firewall (515)</span>
                            </div>
                            <div class="card-actions">
                                <span class="server-stat-badge" :class="{
                                    'badge-success': serverHealth.firewall_syslog?.active,
                                    'badge-error': serverHealth.firewall_syslog && !serverHealth.firewall_syslog.active
                                }" style="font-size: 0.7em;" x-text="serverHealth.firewall_syslog?.active ? 'ACTIVE' : 'INACTIVE'"></span>
                            </div>
                        </h2>
                        <div class="widget-body" style="padding: 12px 16px;">
                            <div style="font-size: 0.85em; color: var(--text-secondary); display: flex; flex-direction: column; gap: 6px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Received:</span>
                                    <span style="color: var(--text-primary); font-weight: 500;" x-text="serverHealth.firewall_syslog?.received ? serverHealth.firewall_syslog.received.toLocaleString() : '0'"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Parsed:</span>
                                    <span style="color: var(--text-primary); font-weight: 500;" x-text="serverHealth.firewall_syslog?.parsed ? serverHealth.firewall_syslog.parsed.toLocaleString() : '0'"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Errors:</span>
                                    <span style="color: var(--text-primary); font-weight: 500;" x-text="serverHealth.firewall_syslog?.errors ? serverHealth.firewall_syslog.errors.toLocaleString() : '0'"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Rate:</span>
                                    <span style="color: var(--text-primary); font-weight: 500;" x-text="ingestionRates?.rates?.firewall_eps !== undefined ? ingestionRates.rates.firewall_eps + ' /s' : '‚Äî'"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row 4: Application Internals -->
                <div class="card" style="margin-bottom: 16px;">
                    <h2>
                        <div class="card-title-content">
                            <span class="title-icon">‚öôÔ∏è</span>
                            <span>Application</span>
                        </div>
                        <div class="card-actions">
                            <span class="server-stat-badge badge-success" style="font-size: 0.7em;">RUNNING</span>
                        </div>
                    </h2>
                    <div class="widget-body" style="padding: 16px 20px;">
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px;">
                            <!-- Process Info -->
                            <div>
                                <div style="font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;">Process</div>
                                <div style="font-size: 1em; color: var(--text-primary);" x-text="serverHealth.system?.process_name || 'python3'"></div>
                            </div>
                            <div>
                                <div style="font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;">Memory</div>
                                <div style="font-size: 1em; color: var(--text-primary);" x-text="serverHealth.process?.process_memory_mb ? serverHealth.process.process_memory_mb + ' MB' : '‚Äî'"></div>
                            </div>
                            <div>
                                <div style="font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;">Threads</div>
                                <div style="font-size: 1em; color: var(--text-primary);" x-text="serverHealth.process?.threads || serverHealth.system?.process_threads || '‚Äî'"></div>
                            </div>
                            <div>
                                <div style="font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;">Cache Entries</div>
                                <div style="font-size: 1em; color: var(--text-primary);" x-text="((serverHealth.cache?.dns_cache_size || 0) + (serverHealth.cache?.geo_cache_size || 0) + (serverHealth.cache?.common_cache_size || 0)).toLocaleString()"></div>
                            </div>
                        </div>

                        <!-- Cache Breakdown -->
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <div style="font-size: 0.8em; color: var(--text-secondary); margin-bottom: 8px;">Cache Breakdown</div>
                            <div style="display: flex; gap: 24px; flex-wrap: wrap; font-size: 0.85em;">
                                <div>
                                    <span style="color: var(--text-secondary);">DNS:</span>
                                    <span style="color: var(--text-primary); margin-left: 6px;" x-text="serverHealth.cache?.dns_cache_size?.toLocaleString() || '0'"></span>
                                    <span style="color: var(--text-muted);"> entries</span>
                                </div>
                                <div>
                                    <span style="color: var(--text-secondary);">GeoIP:</span>
                                    <span style="color: var(--text-primary); margin-left: 6px;" x-text="serverHealth.cache?.geo_cache_size?.toLocaleString() || '0'"></span>
                                    <span style="color: var(--text-muted);"> entries</span>
                                </div>
                                <div>
                                    <span style="color: var(--text-secondary);">Common:</span>
                                    <span style="color: var(--text-primary); margin-left: 6px;" x-text="serverHealth.cache?.common_cache_size?.toLocaleString() || '0'"></span>
                                    <span style="color: var(--text-muted);"> entries</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row 5: Runtime Monitoring (2x2 grid) -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px;">
                    <!-- Services Card -->
                    <div class="card">
                        <h2 style="font-size: 0.85em; padding: 8px 12px;">
                            <div class="card-title-content">
                                <span class="title-icon">üîß</span>
                                <span>Services</span>
                            </div>
                            <div class="card-actions">
                                <span class="server-stat-badge" :class="{
                                    'badge-success': monitoringSummary.dependencies?.nfcapd?.running && monitoringSummary.dependencies?.syslog_514?.listening && monitoringSummary.dependencies?.syslog_515?.listening,
                                    'badge-warning': !(monitoringSummary.dependencies?.nfcapd?.running && monitoringSummary.dependencies?.syslog_514?.listening && monitoringSummary.dependencies?.syslog_515?.listening)
                                }" style="font-size: 0.65em;" x-text="monitoringSummary.dependencies?.nfcapd?.running && monitoringSummary.dependencies?.syslog_514?.listening && monitoringSummary.dependencies?.syslog_515?.listening ? 'ALL OK' : 'DEGRADED'"></span>
                            </div>
                        </h2>
                        <div class="widget-body" style="padding: 8px 12px;">
                            <table style="width: 100%; font-size: 0.8em; border-collapse: collapse;">
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">nfcapd</td>
                                    <td style="padding: 3px 0; text-align: right;">
                                        <span :class="monitoringSummary.dependencies?.nfcapd?.running ? 'text-green' : 'text-red'" x-text="monitoringSummary.dependencies?.nfcapd?.running ? '‚óè Running' : '‚óã Stopped'"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">Syslog 514</td>
                                    <td style="padding: 3px 0; text-align: right;">
                                        <span :class="monitoringSummary.dependencies?.syslog_514?.listening ? 'text-green' : 'text-red'" x-text="monitoringSummary.dependencies?.syslog_514?.listening ? '‚óè Listening' : '‚óã Down'"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">Syslog 515</td>
                                    <td style="padding: 3px 0; text-align: right;">
                                        <span :class="monitoringSummary.dependencies?.syslog_515?.listening ? 'text-green' : 'text-red'" x-text="monitoringSummary.dependencies?.syslog_515?.listening ? '‚óè Listening' : '‚óã Down'"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">Threads</td>
                                    <td style="padding: 3px 0; text-align: right;">
                                        <span :class="monitoringSummary.thread_health?.ok === monitoringSummary.thread_health?.total ? 'text-green' : 'text-yellow'" x-text="(monitoringSummary.thread_health?.ok || 0) + '/' + (monitoringSummary.thread_health?.total || 0) + ' healthy'"></span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <!-- Network I/O Card -->
                    <div class="card">
                        <h2 style="font-size: 0.85em; padding: 8px 12px;">
                            <div class="card-title-content">
                                <span class="title-icon">üì∂</span>
                                <span>Network I/O</span>
                            </div>
                        </h2>
                        <div class="widget-body" style="padding: 8px 12px;">
                            <table style="width: 100%; font-size: 0.8em; border-collapse: collapse;">
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">‚Üì Inbound</td>
                                    <td style="padding: 3px 0; text-align: right; color: var(--neon-cyan); font-weight: 500;" x-text="monitoringSummary.network_io?.rx_mbps !== undefined ? monitoringSummary.network_io.rx_mbps + ' Mbps' : '‚Äî'"></td>
                                </tr>
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">‚Üë Outbound</td>
                                    <td style="padding: 3px 0; text-align: right; color: var(--signal-ok); font-weight: 500;" x-text="monitoringSummary.network_io?.tx_mbps !== undefined ? monitoringSummary.network_io.tx_mbps + ' Mbps' : '‚Äî'"></td>
                                </tr>
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">Errors</td>
                                    <td style="padding: 3px 0; text-align: right;" :class="((monitoringSummary.network_io?.interfaces?.eth0?.rx_errors || 0) + (monitoringSummary.network_io?.interfaces?.eth0?.tx_errors || 0)) > 0 ? 'text-yellow' : 'text-muted'" x-text="((monitoringSummary.network_io?.interfaces?.eth0?.rx_errors || 0) + (monitoringSummary.network_io?.interfaces?.eth0?.tx_errors || 0))"></td>
                                </tr>
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">Dropped</td>
                                    <td style="padding: 3px 0; text-align: right;" :class="((monitoringSummary.network_io?.interfaces?.eth0?.rx_dropped || 0) + (monitoringSummary.network_io?.interfaces?.eth0?.tx_dropped || 0)) > 0 ? 'text-yellow' : 'text-muted'" x-text="((monitoringSummary.network_io?.interfaces?.eth0?.rx_dropped || 0) + (monitoringSummary.network_io?.interfaces?.eth0?.tx_dropped || 0))"></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <!-- HTTP Metrics Card -->
                    <div class="card">
                        <h2 style="font-size: 0.85em; padding: 8px 12px;">
                            <div class="card-title-content">
                                <span class="title-icon">üåê</span>
                                <span>HTTP Metrics</span>
                            </div>
                            <div class="card-actions">
                                <span class="server-stat-badge" :class="{
                                    'badge-success': (monitoringSummary.http?.error_rate_percent || 0) < 1,
                                    'badge-warning': (monitoringSummary.http?.error_rate_percent || 0) >= 1 && (monitoringSummary.http?.error_rate_percent || 0) < 5,
                                    'badge-error': (monitoringSummary.http?.error_rate_percent || 0) >= 5
                                }" style="font-size: 0.65em;" x-text="(monitoringSummary.http?.error_rate_percent || 0) + '% errors'"></span>
                            </div>
                        </h2>
                        <div class="widget-body" style="padding: 8px 12px;">
                            <table style="width: 100%; font-size: 0.8em; border-collapse: collapse;">
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">Total Requests</td>
                                    <td style="padding: 3px 0; text-align: right; color: var(--text-primary);" x-text="monitoringSummary.http?.total_requests?.toLocaleString() || '0'"></td>
                                </tr>
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">Active Now</td>
                                    <td style="padding: 3px 0; text-align: right; color: var(--text-primary);" x-text="monitoringSummary.http?.concurrent_requests || '0'"></td>
                                </tr>
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">Peak Concurrent</td>
                                    <td style="padding: 3px 0; text-align: right; color: var(--text-primary);" x-text="monitoringSummary.http?.peak_concurrent || '0'"></td>
                                </tr>
                                <tr>
                                    <td style="padding: 3px 0; color: var(--text-secondary);">5xx Errors</td>
                                    <td style="padding: 3px 0; text-align: right;" :class="(monitoringSummary.http?.status_codes?.['500'] || 0) + (monitoringSummary.http?.status_codes?.['502'] || 0) + (monitoringSummary.http?.status_codes?.['503'] || 0) > 0 ? 'text-red' : 'text-muted'" x-text="(monitoringSummary.http?.status_codes?.['500'] || 0) + (monitoringSummary.http?.status_codes?.['502'] || 0) + (monitoringSummary.http?.status_codes?.['503'] || 0)"></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <!-- Container/Runtime Card -->
                    <div class="card">
                        <h2 style="font-size: 0.85em; padding: 8px 12px;">
                            <div class="card-title-content">
                                <span class="title-icon" x-text="monitoringSummary.container?.is_containerized ? 'üê≥' : 'üñ•Ô∏è'"></span>
                                <span x-text="monitoringSummary.container?.is_containerized ? 'Container' : 'Runtime'"></span>
                            </div>
                            <template x-if="monitoringSummary.container?.is_containerized">
                                <div class="card-actions">
                                    <span class="server-stat-badge" :class="{
                                        'badge-success': (monitoringSummary.container?.memory_usage_percent || 0) < 80,
                                        'badge-warning': (monitoringSummary.container?.memory_usage_percent || 0) >= 80 && (monitoringSummary.container?.memory_usage_percent || 0) < 90,
                                        'badge-error': (monitoringSummary.container?.memory_usage_percent || 0) >= 90
                                    }" style="font-size: 0.65em;" x-text="(monitoringSummary.container?.memory_usage_percent || 0) + '% mem'"></span>
                                </div>
                            </template>
                        </h2>
                        <div class="widget-body" style="padding: 8px 12px;">
                            <template x-if="monitoringSummary.container?.is_containerized">
                                <table style="width: 100%; font-size: 0.8em; border-collapse: collapse;">
                                    <tr>
                                        <td style="padding: 3px 0; color: var(--text-secondary);">Memory Used</td>
                                        <td style="padding: 3px 0; text-align: right;" :class="{
                                            'text-green': (monitoringSummary.container?.memory_usage_percent || 0) < 80,
                                            'text-yellow': (monitoringSummary.container?.memory_usage_percent || 0) >= 80 && (monitoringSummary.container?.memory_usage_percent || 0) < 90,
                                            'text-red': (monitoringSummary.container?.memory_usage_percent || 0) >= 90
                                        }" x-text="monitoringSummary.container?.memory_usage_percent !== null ? monitoringSummary.container.memory_usage_percent + '%' : '‚Äî'"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; color: var(--text-secondary);">Memory Limit</td>
                                        <td style="padding: 3px 0; text-align: right; color: var(--text-primary);" x-text="monitoringSummary.container?.memory_limit_mb ? monitoringSummary.container.memory_limit_mb + ' MB' : '‚Äî'"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; color: var(--text-secondary);">CPU Throttled</td>
                                        <td style="padding: 3px 0; text-align: right;" :class="(monitoringSummary.container?.cpu_throttled_periods || 0) > 100 ? 'text-yellow' : 'text-muted'" x-text="monitoringSummary.container?.cpu_throttled_periods ?? '0'"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; color: var(--text-secondary);">OOM Kills</td>
                                        <td style="padding: 3px 0; text-align: right;" :class="(monitoringSummary.container?.oom_kill_count || 0) > 0 ? 'text-red' : 'text-green'" x-text="monitoringSummary.container?.oom_kill_count ?? '0'"></td>
                                    </tr>
                                </table>
                            </template>
                            <template x-if="!monitoringSummary.container?.is_containerized">
                                <table style="width: 100%; font-size: 0.8em; border-collapse: collapse;">
                                    <tr>
                                        <td style="padding: 3px 0; color: var(--text-secondary);">Mode</td>
                                        <td style="padding: 3px 0; text-align: right; color: var(--text-primary);">Host Process</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; color: var(--text-secondary);">Process Memory</td>
                                        <td style="padding: 3px 0; text-align: right; color: var(--text-primary);" x-text="serverHealth.process?.process_memory_mb ? serverHealth.process.process_memory_mb + ' MB' : '‚Äî'"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; color: var(--text-secondary);">Threads</td>
                                        <td style="padding: 3px 0; text-align: right; color: var(--text-primary);" x-text="serverHealth.process?.threads || serverHealth.system?.process_threads || '‚Äî'"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; color: var(--text-secondary);">Limits</td>
                                        <td style="padding: 3px 0; text-align: right; color: var(--text-muted);">None (host)</td>
                                    </tr>
                                </table>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Row 6: Database (SQLite) Statistics -->
                <div style="margin-bottom: 16px;">
                    <h2 style="margin-bottom: 12px; font-size: 1em; color: var(--text-primary);">Database (SQLite)</h2>

                    <!-- Loading State -->
                    <template x-if="databaseStats.loading">
                        <div class="empty-state">
                            <span>Loading database statistics...</span>
                        </div>
                    </template>

                    <!-- Error State -->
                    <template x-if="databaseStats.error && !databaseStats.loading">
                        <div class="empty-state" style="color: var(--neon-red);">
                            <span x-text="databaseStats.error"></span>
                        </div>
                    </template>

                    <!-- Database Stats Content -->
                    <template x-if="!databaseStats.loading && !databaseStats.error && databaseStats.databases">
                        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
                            <template x-for="db in databaseStats.databases" :key="db.name">
                                <div class="card">
                                    <h3 style="margin-bottom: 12px; font-size: 0.95em; color: var(--text-primary); padding: 12px 16px 0 16px;">
                                        <span x-text="db.name"></span> Database
                                        <template x-if="db.error">
                                            <span style="color: var(--neon-red); font-size: 0.85em; margin-left: 8px;">‚ö†Ô∏è</span>
                                        </template>
                                    </h3>
                                    <div class="widget-body" style="padding: 0 16px 16px 16px;">
                                        <!-- Stat Cards -->
                                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 12px;">
                                            <!-- File Size -->
                                            <div style="padding: 8px; background: rgba(0,0,0,0.2); border-radius: 4px;">
                                                <div style="font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;">File Size</div>
                                                <div style="font-size: 0.95em; color: var(--text-primary);" x-text="db.file_size ? fmtBytes(db.file_size) : 'N/A'"></div>
                                            </div>

                                            <!-- Total Records -->
                                            <div style="padding: 8px; background: rgba(0,0,0,0.2); border-radius: 4px;">
                                                <div style="font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;">Records</div>
                                                <div style="font-size: 0.95em; color: var(--text-primary);" x-text="db.total_records ? db.total_records.toLocaleString() : 'N/A'"></div>
                                            </div>

                                            <!-- WAL Status -->
                                            <div style="padding: 8px; background: rgba(0,0,0,0.2); border-radius: 4px;">
                                                <div style="font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;">WAL</div>
                                                <div style="font-size: 0.95em; color: var(--text-primary);">
                                                    <template x-if="db.wal_exists">
                                                        <span x-text="fmtBytes(db.wal_size)"></span>
                                                    </template>
                                                    <template x-if="!db.wal_exists && db.journal_mode && db.journal_mode.toLowerCase() === 'wal'">
                                                        <span style="color: var(--text-secondary); opacity: 0.8;">WAL mode (idle)</span>
                                                    </template>
                                                    <template x-if="!db.wal_exists && (!db.journal_mode || db.journal_mode.toLowerCase() !== 'wal')">
                                                        <span style="color: var(--text-secondary); opacity: 0.7;">Not enabled</span>
                                                    </template>
                                                </div>
                                            </div>

                                            <!-- Last Write -->
                                            <div style="padding: 8px; background: rgba(0,0,0,0.2); border-radius: 4px;">
                                                <div style="font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;">Last Write</div>
                                                <div style="font-size: 0.85em; color: var(--text-primary);" x-text="db.last_write ? new Date(db.last_write).toLocaleString() : 'N/A'"></div>
                                            </div>
                                        </div>

                                        <!-- Retention Awareness -->
                                        <template x-if="db.oldest_record_age">
                                            <div style="margin-bottom: 12px; padding: 8px; background: rgba(0,0,0,0.1); border-radius: 4px; border-left: 2px solid rgba(255,255,255,0.2);">
                                                <div style="font-size: 0.8em; color: var(--text-secondary);">
                                                    <span style="opacity: 0.8;">Oldest Record:</span>
                                                    <span style="margin-left: 6px; color: var(--text-primary);" x-text="db.oldest_record_age"></span>
                                                </div>
                                            </div>
                                        </template>

                                        <!-- Config Details -->
                                        <div style="padding: 10px; background: rgba(0,0,0,0.15); border-radius: 4px; border-top: 1px solid rgba(255,255,255,0.1);">
                                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; font-size: 0.8em;">
                                                <div>
                                                    <span style="color: var(--text-secondary);">SQLite:</span>
                                                    <span style="color: var(--text-primary); margin-left: 4px;" x-text="db.sqlite_version || 'N/A'"></span>
                                                </div>
                                                <div>
                                                    <span style="color: var(--text-secondary);">Journal:</span>
                                                    <span style="color: var(--text-primary); margin-left: 4px;" x-text="db.journal_mode || 'N/A'"></span>
                                                </div>
                                                <div>
                                                    <span style="color: var(--text-secondary);">Sync:</span>
                                                    <span style="color: var(--text-primary); margin-left: 4px;" x-text="db.synchronous || 'N/A'"></span>
                                                </div>
                                                <div>
                                                    <span style="color: var(--text-secondary);">Page:</span>
                                                    <span style="color: var(--text-primary); margin-left: 4px;" x-text="db.page_size ? fmtBytes(db.page_size) : 'N/A'"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>

                <!-- Row 6: Server Logs Widget -->
                <div class="card">
                    <h2>
                        <div class="card-title-content">
                            <span class="title-icon">üìã</span>
                            <span>Server Logs</span>
                        </div>
                        <div class="card-actions">
                            <span class="server-stat-badge" :class="{
                                'badge-success': serverLogs.source === 'buffer' || serverLogs.source === 'docker',
                                'badge-warning': serverLogs.source === 'files',
                                'badge-error': serverLogs.source === 'none'
                            }" x-text="serverLogs.source === 'docker' ? 'DOCKER' : (serverLogs.source === 'buffer' ? 'BUFFER' : (serverLogs.source === 'files' ? 'FILES' : 'N/A'))"></span>
                        </div>
                    </h2>
                    <div class="widget-body" style="min-height: 400px; max-height: 600px; display: flex; flex-direction: column;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <span style="font-size: 0.85em; color: var(--text-secondary);">Lines:</span>
                                <select x-model="serverLogs.lines" @change="fetchServerLogs(serverLogs.lines)"
                                    aria-label="Number of log lines to display" title="Number of log lines"
                                    style="padding: 4px 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; color: var(--text-primary); font-size: 0.85em;">
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                    <option value="200">200</option>
                                    <option value="500">500</option>
                                </select>
                                <button @click="fetchServerLogs(serverLogs.lines)" aria-label="Refresh server logs" title="Refresh logs"
                                    style="padding: 4px 12px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; color: var(--text-primary); cursor: pointer; font-size: 0.85em;"
                                    :disabled="serverLogs.loading">
                                    <span x-text="serverLogs.loading ? 'Loading...' : 'Refresh'"></span>
                                </button>
                            </div>
                            <span style="font-size: 0.85em; color: var(--text-secondary);" x-text="serverLogs.count + ' lines'"></span>
                        </div>
                        <div x-show="serverLogs.loading" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <span>Loading logs...</span>
                        </div>
                        <div x-show="!serverLogs.loading && serverLogs.logs.length > 0"
                            style="flex: 1; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 4px; padding: 12px; font-family: 'Courier New', monospace; font-size: 0.85em; line-height: 1.6;">
                            <template x-for="(log, index) in serverLogs.logs" :key="index">
                                <div style="margin-bottom: 2px; color: var(--text-secondary); word-break: break-all;" x-text="log"></div>
                            </template>
                        </div>
                        <div x-show="!serverLogs.loading && serverLogs.logs.length === 0"
                            style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <span>No logs available</span>
                        </div>
                        <div x-show="serverLogs.container"
                            style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.8em; color: var(--text-secondary);">
                            <span>Container: </span><span x-text="serverLogs.container"></span>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </section>
</div>

<!-- Resource History Chart Rendering -->
<script>
(function() {
    // Simple sparkline rendering for resource history charts
    function renderResourceHistoryCharts() {
        const store = Alpine.store ? Alpine.store('dashboard') : null;
        if (!store || !store.resourceHistory?.history?.length) return;

        const history = store.resourceHistory.history;

        // CPU Chart
        const cpuCanvas = document.querySelector('[x-ref="cpuHistoryChart"]');
        if (cpuCanvas) {
            const cpuValues = history.map(s => s.cpu_percent ?? null);
            renderSparkline(cpuCanvas, cpuValues, '#00ff88');
        }

        // Memory Chart
        const memCanvas = document.querySelector('[x-ref="memHistoryChart"]');
        if (memCanvas) {
            const memValues = history.map(s => s.mem_percent ?? null);
            renderSparkline(memCanvas, memValues, '#00f3ff');
        }
    }

    function renderSparkline(canvas, values, color) {
        const ctx = canvas.getContext('2d');
        const width = canvas.offsetWidth || 200;
        const height = canvas.offsetHeight || 80;

        // Set canvas resolution
        canvas.width = width * 2;
        canvas.height = height * 2;
        ctx.scale(2, 2);

        ctx.clearRect(0, 0, width, height);

        // Filter valid values
        const validValues = values.filter(v => v !== null && v !== undefined);
        if (validValues.length < 2) return;

        const max = Math.max(...validValues, 100);
        const min = 0;
        const range = max - min || 1;

        // Draw filled area
        ctx.beginPath();
        ctx.moveTo(0, height);

        let lastX = 0;
        let lastY = height;
        values.forEach((v, i) => {
            const x = (i / (values.length - 1)) * width;
            if (v !== null && v !== undefined) {
                const y = height - ((v - min) / range) * (height - 10) - 5;
                if (i === 0 || values[i - 1] === null) {
                    ctx.lineTo(x, height);
                }
                ctx.lineTo(x, y);
                lastX = x;
                lastY = y;
            }
        });

        ctx.lineTo(lastX, height);
        ctx.closePath();

        // Gradient fill
        const gradient = ctx.createLinearGradient(0, 0, 0, height);
        gradient.addColorStop(0, color + '40');
        gradient.addColorStop(1, color + '05');
        ctx.fillStyle = gradient;
        ctx.fill();

        // Draw line
        ctx.beginPath();
        let started = false;
        values.forEach((v, i) => {
            if (v !== null && v !== undefined) {
                const x = (i / (values.length - 1)) * width;
                const y = height - ((v - min) / range) * (height - 10) - 5;
                if (!started) {
                    ctx.moveTo(x, y);
                    started = true;
                } else {
                    ctx.lineTo(x, y);
                }
            }
        });
        ctx.strokeStyle = color;
        ctx.lineWidth = 1.5;
        ctx.stroke();
    }

    // Re-render charts when data changes
    document.addEventListener('alpine:init', () => {
        // Watch for resource history changes
        setInterval(() => {
            if (document.querySelector('#server-tab')?.style.display !== 'none') {
                renderResourceHistoryCharts();
            }
        }, 2000);
    });

    // Initial render on page load
    if (document.readyState === 'complete') {
        setTimeout(renderResourceHistoryCharts, 1000);
    } else {
        window.addEventListener('load', () => setTimeout(renderResourceHistoryCharts, 1000));
    }
})();
</script>

<!-- ============================================
             FIREWALL SNMP STATUS TAB
             ============================================ -->
