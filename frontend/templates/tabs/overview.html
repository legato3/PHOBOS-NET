<div x-show="activeTab === 'overview'" id="overview-tab" role="tabpanel" class="custom-scroll"
    style="display:none; height:100%; padding-bottom:40px; width:100%; margin:0; padding:20px; overflow-y: auto;"
    x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100">

    <!-- LEGACY HEADER METRICS (Restored) -->
    <div style="display:grid; grid-template-columns: repeat(6, 1fr); gap:var(--space-4); margin-bottom:var(--space-6);">
        <!-- 1. HEALTH -->
        <div class="card"
            style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:15px; background:rgba(20,20,25,0.6); border:1px solid var(--card-border);">
            <div style="font-size:1.1em; font-weight:600; color:var(--signal-ok); margin-bottom:4px;">Healthy</div>
            <div style="font-size:0.65em; color:var(--text-tertiary); letter-spacing:1px;">OVERALL HEALTH</div>
        </div>

        <!-- 2. ACTIVE ALERTS -->
        <div class="card"
            style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:15px; background:rgba(20,20,25,0.6); border:1px solid var(--card-border);">
            <div style="font-size:1.4em; font-weight:600; color:var(--text-primary); margin-bottom:2px;"
                x-text="radar.metrics?.active_alerts || '0'"></div>
            <div style="font-size:0.65em; color:var(--text-tertiary); letter-spacing:1px;">ACTIVE ALERTS</div>
        </div>

        <!-- 3. ACTIVE FLOWS -->
        <div class="card"
            style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:15px; background:rgba(20,20,25,0.6); border:1px solid var(--card-border);">
            <div style="display:flex; align-items:baseline; gap:4px; margin-bottom:2px;">
                <span style="font-size:1.4em; font-weight:600; color:var(--text-primary);"
                    x-text="radar.metrics?.active_flows || '0'"></span>
            </div>
            <div style="font-size:0.65em; color:var(--text-tertiary); letter-spacing:1px;">ACTIVE FLOWS</div>
        </div>

        <!-- 4. EXTERNAL CONNECTIONS -->
        <div class="card"
            style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:15px; background:rgba(20,20,25,0.6); border:1px solid var(--card-border);">
            <div style="display:flex; align-items:baseline; gap:4px; margin-bottom:2px;">
                <span style="font-size:1.4em; font-weight:600; color:var(--text-primary);"
                    x-text="radar.metrics?.external_conns || '0'"></span>
            </div>
            <div style="font-size:0.65em; color:var(--text-tertiary); letter-spacing:1px;">EXTERNAL CONNECTIONS</div>
        </div>

        <!-- 5. BLOCKED EVENTS -->
        <div class="card"
            style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:15px; background:rgba(20,20,25,0.6); border:1px solid var(--card-border);">
            <div style="display:flex; align-items:baseline; gap:4px; margin-bottom:2px;">
                <span style="font-size:1.4em; font-weight:600; color:var(--text-primary);"
                    x-text="radar.metrics?.firewall_blocks_24h || '0'"></span>
            </div>
            <div style="font-size:0.65em; color:var(--text-tertiary); letter-spacing:1px;">BLOCKED EVENTS (24H)</div>
        </div>

        <!-- 6. ANOMALIES -->
        <div class="card"
            style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:15px; background:rgba(20,20,25,0.6); border:1px solid var(--card-border);">
            <div style="display:flex; align-items:baseline; gap:4px; margin-bottom:2px;">
                <span style="font-size:1.4em; font-weight:600; color:var(--signal-warn);"
                    x-text="radar.metrics?.anomalies_24h || '0'"></span>
            </div>
            <div style="font-size:0.65em; color:var(--text-tertiary); letter-spacing:1px;">ANOMALIES (24H)</div>
        </div>
    </div>

    <!-- OVERVIEW GRID: Radar + Movers + Stream -->
    <div class="overview-grid"
        style="display: grid; grid-template-columns: 2.2fr 1fr; gap: var(--space-4); margin-bottom: var(--space-6);">

        <!-- COLUMN 1: RADAR (Top Left) -->
        <!-- FIXED 420px HEIGHT as requested to match layout constraints exactly -->
        <div class="card status-card" style="height: 420px; display: flex; flex-direction: column; overflow: hidden;">
            <h2>
                <div class="card-title-content" style="display: flex; align-items: center; flex: 1; min-width: 0;">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <div class="radar-scan"></div>
                        <span
                            style="font-size:0.95em; letter-spacing:1px; color:var(--text-primary); text-transform:uppercase; font-weight:600;">Live
                            Network Radar</span>
                    </div>
                    <span class="period-badge" x-text="radar.loading ? 'SCANNING...' : 'LIVE 15M WINDOW'"
                        style="margin-left: auto; font-size: 0.7em; color: var(--text-tertiary); font-weight: 500; padding: 2px 6px; border: 1px solid rgba(255,255,255,0.05); border-radius: 4px; text-transform: uppercase; white-space: nowrap; flex-shrink: 0;"></span>
                </div>
            </h2>

            <div class="widget-body" style="flex:1; display:flex; flex-direction:column; padding:0; overflow: hidden;">

                <!-- Radar Content (Scrollable Area) -->
                <div
                    style="padding:var(--space-4); flex:1; display:flex; flex-direction:column; justify-content:flex-start; overflow-y: auto;">

                    <div x-show="radar.loading"
                        style="display:flex; justify-content:center; align-items:center; flex:1;">
                        <div style="text-align:center;">
                            <div class="spinner" style="margin-bottom:10px;"></div>
                            <div style="font-size:0.8em; color:var(--text-tertiary);">Analyzing telemetry...</div>
                        </div>
                    </div>

                    <div x-show="!radar.loading" style="display:flex; flex-direction:column;">
                        <!-- A) NETWORK TONE -->
                        <div class="radar-tone" style="margin-bottom:16px; margin-top:0;">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <div style="width:8px; height:8px; border-radius:50%; flex-shrink: 0;"
                                    :style="radar.status === 'warn' ? 'background:var(--signal-warn); box-shadow:0 0 8px var(--signal-warn);' : (radar.status === 'notice' ? 'background:var(--signal-notice);' : 'background:var(--signal-ok); box-shadow:0 0 8px rgba(0,255,100,0.2);')">
                                </div>
                                <h1 style="margin:0; font-size:1.5em; font-weight:600; letter-spacing:-0.02em; color:var(--text-primary); line-height:1.2;"
                                    x-text="radar.tone || 'Assessing state...'"></h1>
                            </div>
                        </div>

                        <!-- METRICS / STAT BOXES (Always Visible) -->
                        <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:8px; margin-bottom:16px;">
                            <div
                                style="background:rgba(255,255,255,0.03); padding:8px 10px; border-radius:6px; border:1px solid rgba(255,255,255,0.05);">
                                <div
                                    style="font-size:0.65em; color:var(--text-tertiary); margin-bottom:2px; letter-spacing:0.5px;">
                                    TRAFFIC (15m)</div>
                                <div style="font-family:var(--font-mono); font-size:1.0em; color:var(--text-primary);"
                                    x-text="radar.metrics?.traffic_vol || '725M'"></div>
                            </div>
                            <div
                                style="background:rgba(255,255,255,0.03); padding:8px 10px; border-radius:6px; border:1px solid rgba(255,255,255,0.05);">
                                <div
                                    style="font-size:0.65em; color:var(--text-tertiary); margin-bottom:2px; letter-spacing:0.5px;">
                                    BLOCKED</div>
                                <div style="font-family:var(--font-mono); font-size:1.0em; color:var(--signal-warn);"
                                    x-text="radar.metrics?.firewall_blocks || '24'"></div>
                            </div>
                            <div
                                style="background:rgba(255,255,255,0.03); padding:8px 10px; border-radius:6px; border:1px solid rgba(255,255,255,0.05);">
                                <div
                                    style="font-size:0.65em; color:var(--text-tertiary); margin-bottom:2px; letter-spacing:0.5px;">
                                    EVENTS</div>
                                <div style="font-family:var(--font-mono); font-size:1.0em; color:var(--text-secondary);"
                                    x-text="radar.metrics?.syslog_events || '112'"></div>
                            </div>
                            <div
                                style="background:rgba(255,255,255,0.03); padding:8px 10px; border-radius:6px; border:1px solid rgba(255,255,255,0.05);">
                                <div
                                    style="font-size:0.65em; color:var(--text-tertiary); margin-bottom:2px; letter-spacing:0.5px;">
                                    ACTIVE FLOWS</div>
                                <div style="font-family:var(--font-mono); font-size:1.0em; color:var(--text-secondary);"
                                    x-text="radar.metrics?.active_flows || '12,402'"></div>
                            </div>
                        </div>

                        <div style="display:flex; gap:var(--space-6); flex-wrap:wrap; align-content: flex-start;">

                            <!-- B1) ACTIVE SIGNALS (If any) -->
                            <div style="flex:1; min-width:280px;"
                                x-show="(radar.evidence && radar.evidence.length > 0)">
                                <h4
                                    style="font-size:0.75em; color:var(--text-tertiary); text-transform:uppercase; margin-bottom:var(--space-3); letter-spacing:0.05em;">
                                    Intelligence Signals</h4>
                                <ul
                                    style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px;">
                                    <template x-for="ev in (radar.evidence || [])">
                                        <li
                                            style="display:flex; align-items:start; gap:10px; font-size:0.95em; color:var(--text-secondary);">
                                            <span style="opacity:0.4; margin-top: 5px; font-size: 0.8em;">‚ñ∫</span>
                                            <span x-text="ev" style="line-height: 1.4;"></span>
                                        </li>
                                    </template>
                                </ul>
                            </div>

                            <!-- B2) MONITORING STATUS (If NO signals - Fill the void) -->
                            <div style="flex:1; min-width:280px;"
                                x-show="(!radar.evidence || radar.evidence.length === 0)">
                                <h4
                                    style="font-size:0.75em; color:var(--text-tertiary); text-transform:uppercase; margin-bottom:var(--space-3); letter-spacing:0.05em;">
                                    Active Sensors</h4>
                                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                                    <div
                                        style="background:rgba(255,255,255,0.02); padding:10px; border-radius:4px; border:1px solid rgba(255,255,255,0.05);">
                                        <div style="font-size:0.7em; color:var(--text-tertiary); margin-bottom:2px;">
                                            FIREWALL</div>
                                        <div style="color:var(--signal-ok); font-size:0.9em;">‚óè Monitoring</div>
                                    </div>
                                    <div
                                        style="background:rgba(255,255,255,0.02); padding:10px; border-radius:4px; border:1px solid rgba(255,255,255,0.05);">
                                        <div style="font-size:0.7em; color:var(--text-tertiary); margin-bottom:2px;">
                                            NETFLOW
                                        </div>
                                        <div style="color:var(--signal-ok); font-size:0.9em;">‚óè Analyzing</div>
                                    </div>
                                    <div
                                        style="background:rgba(255,255,255,0.02); padding:10px; border-radius:4px; border:1px solid rgba(255,255,255,0.05);">
                                        <div style="font-size:0.7em; color:var(--text-tertiary); margin-bottom:2px;">
                                            THREAT
                                            FEEDS</div>
                                        <div style="color:var(--signal-ok); font-size:0.9em;">‚óè Syncing</div>
                                    </div>
                                    <div
                                        style="background:rgba(255,255,255,0.02); padding:10px; border-radius:4px; border:1px solid rgba(255,255,255,0.05);">
                                        <div style="font-size:0.7em; color:var(--text-tertiary); margin-bottom:2px;">
                                            ANOMALY
                                            ENG.</div>
                                        <div style="color:var(--signal-ok); font-size:0.9em;">‚óè Active</div>
                                    </div>
                                </div>
                            </div>

                            <!-- C) CONTEXT CARDS (Conditional) -->
                            <div style="display:flex; flex-direction: column; gap:var(--space-3);"
                                x-show="radar.top_talkers && radar.top_talkers.length > 0">

                                <!-- Lead Source -->
                                <div class="ctx-card">
                                    <div class="ctx-label">LEAD SOURCE</div>
                                    <div class="ctx-val" x-text="radar.top_talkers?.[0]?.ip"></div>
                                    <div class="ctx-sub">
                                        <span x-text="radar.top_talkers?.[0]?.bytes_fmt"></span>
                                        <span style="opacity:0.5; margin: 0 4px;">|</span>
                                        <span x-text="radar.top_talkers?.[0]?.hostname || 'Unknown'"></span>
                                    </div>
                                </div>

                                <!-- Lead Dest -->
                                <div class="ctx-card">
                                    <div class="ctx-label">TOP DESTINATION</div>
                                    <div class="ctx-val" x-text="radar.top_destinations?.[0]?.ip"></div>
                                    <div class="ctx-sub">
                                        <span x-text="radar.top_destinations?.[0]?.bytes_fmt"></span>
                                        <span style="opacity:0.5; margin: 0 4px;">|</span>
                                        <span x-text="radar.top_destinations?.[0]?.flag"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Continuous Stream (Now Integrated into Radar Bottom) -->
                <!-- Reduced fixed height to be a modest ticker -->
                <div style="border-top: 1px solid rgba(255,255,255,0.05); background: rgba(0,0,0,0.2); flex-shrink: 0;">
                    <div
                        style="padding:8px 16px; font-size:0.7em; color:var(--text-tertiary); text-transform:uppercase; letter-spacing:1px; background:rgba(255,255,255,0.01);">
                        Recent Activity Stream
                    </div>
                    <div class="scroller-container custom-scroll"
                        style="height: 100px; overflow-y:auto; padding:var(--space-2) 0;">
                        <template x-if="radar.loading">
                            <div style="padding:20px; text-align:center; color:var(--text-muted); font-size: 0.9em;">
                                Syncing stream...</div>
                        </template>

                        <template x-if="!radar.loading && (!radar.changes || radar.changes.length === 0)">
                            <div
                                style="padding:20px; display:flex; flex-direction:column; align-items:center; opacity:0.6;">
                                <div
                                    style="font-family:var(--font-mono); font-size:0.85em; color: var(--text-secondary);">
                                    SYSTEM QUIET</div>
                                <div style="font-size:0.75em; margin-top:4px; color: var(--text-tertiary);">Traffic
                                    patterns holding steady</div>
                            </div>
                        </template>

                        <template x-for="item in radar.changes">
                            <div class="stream-row">
                                <div class="stream-time" x-text="formatTimeAgoShort(item.ts)"></div>
                                <div class="stream-marker" :class="'marker-' + (item.severity || 'info')"></div>
                                <div class="stream-content">
                                    <span class="stream-type" x-text="(item.type || '').replace(/_/g, ' ')"></span>
                                    <span class="stream-msg" x-text="item.message"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <!-- COLUMN 2: TOP MOVERS (Side Panel) -->
        <div class="card status-card"
            style="background:rgba(0,0,0,0.2); border:1px solid var(--card-border); height: 100%; display:flex; flex-direction:column;">
            <div style="padding:var(--space-4); border-bottom:1px solid rgba(255,255,255,0.05);">
                <h3 style="margin:0; font-size:0.9em; color:var(--text-secondary);">TOP MOVERS</h3>
            </div>

            <div style="padding:var(--space-4); flex:1; overflow-y:auto;" class="custom-scroll">

                <!-- MOVER: Talkers -->
                <div class="mover-group">
                    <div class="mover-head">Sources</div>
                    <template x-if="!radar.top_talkers || radar.top_talkers.length === 0">
                        <div class="mover-empty">No data</div>
                    </template>
                    <template x-for="(item, idx) in (radar.top_talkers || []).slice(0,5)">
                        <div class="mover-row">
                            <div class="mover-rank" x-text="idx + 1"></div>
                            <div class="mover-info">
                                <div class="mover-main" x-text="item.ip"></div>
                                <div class="mover-sub" x-text="item.hostname || 'Unknown'"></div>
                            </div>
                            <div class="mover-val" x-text="item.bytes_fmt"></div>
                        </div>
                    </template>
                </div>

                <!-- MOVER: Dests -->
                <div class="mover-group">
                    <div class="mover-head">Destinations</div>
                    <template x-if="!radar.top_destinations || radar.top_destinations.length === 0">
                        <div class="mover-empty">No data</div>
                    </template>
                    <template x-for="(item, idx) in (radar.top_destinations || []).slice(0,5)">
                        <div class="mover-row">
                            <div class="mover-rank" x-text="idx + 1"></div>
                            <div class="mover-info">
                                <div class="mover-main">
                                    <span x-text="item.flag" style="margin-right:4px;"></span>
                                    <span x-text="item.ip"></span>
                                </div>
                                <div class="mover-sub" x-text="item.hostname || 'Unknown'"></div>
                            </div>
                            <div class="mover-val" x-text="item.bytes_fmt"></div>
                        </div>
                    </template>
                </div>

                <!-- MOVER: Ports -->
                <div class="mover-group">
                    <div class="mover-head">Services</div>
                    <template x-if="!radar.top_ports || radar.top_ports.length === 0">
                        <div class="mover-empty">No data</div>
                    </template>
                    <template x-for="(item, idx) in (radar.top_ports || []).slice(0,5)">
                        <div class="mover-row">
                            <div class="mover-rank" x-text="idx + 1"></div>
                            <div class="mover-info">
                                <div class="mover-main" x-text="'Port ' + item.port"></div>
                            </div>
                            <div class="mover-val" x-text="item.bytes_fmt"></div>
                        </div>
                    </template>
                </div>

            </div>
        </div>
    </div>

    <!-- LEGACY WIDGETS RESTORED (Context & Deep Dive) -->
    <div style="margin-top: var(--space-6); border-top: 1px solid var(--border-soft); padding-top: var(--space-6);">
        <!-- Bandwidth Chart (Conditional) -->
        <template x-if="isVisible('bandwidth')">
            {% call widget_card('bandwidth', 'Bandwidth & Flow Rate', 'üìä',
            period_x_text='global_time_range') %}
            <!-- Mobile Toggle for Bandwidth Chart -->
            <div class="mobile-chart-toggle" x-data="{ collapsed: window.innerWidth <= 768 }">
                <button class="world-map-toggle" style="margin-bottom: 12px;" x-show="window.innerWidth <= 768"
                    @click="collapsed = !collapsed">
                    <span x-text="collapsed ? 'üìä Show Chart' : 'üìä Hide Chart'"></span>
                </button>
                <div class="chart-wrapper chart-expandable" x-show="!collapsed || window.innerWidth > 768"
                    @click="openFullscreenChart('bwChart', 'Bandwidth & Flow Rate')" title="Click to expand">
                    <canvas id="bwChart"></canvas>
                </div>
            </div>
            {% endcall %}
        </template>
    </div>

    <div style="margin-top: var(--space-6);">
        <!-- World Map Section -->
        <section id="section-worldmap" class="scroll-section">
            <!-- Logic for World Map (Same as Step 141) -->
            {% set wm_actions %}
            <div class="world-map-mode-toggle">
                <button class="world-map-mode-btn" :class="{ 'active': worldMapMode === 'traffic' }"
                    @click="worldMapMode = 'traffic'" title="Traffic view - balanced emphasis">
                    Traffic
                </button>
                <button class="world-map-mode-btn" :class="{ 'active': worldMapMode === 'exposure' }"
                    @click="worldMapMode = 'exposure'" title="Exposure view - emphasize destinations">
                    Exposure
                </button>
                <button class="world-map-mode-btn" :class="{ 'active': worldMapMode === 'attacks' }"
                    @click="worldMapMode = 'attacks'" title="View Threats & Blocked traffic">
                    Threats & Blocks
                </button>
            </div>
            <div class="world-map-layer-toggles">
                <label class="world-map-layer-toggle" :class="{ 'active': worldMapLayers.sources }"
                    title="Toggle Sources layer">
                    <input type="checkbox" x-model="worldMapLayers.sources">
                    <span class="layer-dot layer-dot-cyan"></span>
                    <span class="layer-label">Sources</span>
                </label>
                <label class="world-map-layer-toggle" :class="{ 'active': worldMapLayers.destinations }"
                    title="Toggle Destinations layer">
                    <input type="checkbox" x-model="worldMapLayers.destinations">
                    <span class="layer-dot layer-dot-purple"></span>
                    <span class="layer-label">Destinations</span>
                </label>
                <label class="world-map-layer-toggle" :class="{ 'active': worldMapLayers.threats }"
                    title="Toggle Threats layer">
                    <input type="checkbox" x-model="worldMapLayers.threats">
                    <span class="layer-dot layer-dot-red"></span>
                    <span class="layer-label">Threats</span>
                </label>
            </div>
            <button class="world-map-reset-btn" @click="resetWorldMapView()" title="Reset map view">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 6v6l4 2"></path>
                </svg>
                Reset
            </button>
            {% endset %}

            {% set wm_title %}
            <div>
                <span>Traffic World Map</span>
                <span x-show="mapStatus" x-text="'[' + mapStatus + ']'" class="text-75 text-yellow ml-2"></span>
            </div>
            {% endset %}

            {% call widget_card('worldmap', wm_title, 'üó∫Ô∏è', card_class='wide-card world-map-card',
            extra_actions=wm_actions) %}
            <div class="world-map-container" style="min-height: 400px;">
                <div id="world-map-svg" class="world-map-svg"></div>
                <div x-show="worldMap.loading" class="spinner-overlay">
                    <div class="spinner"></div>
                </div>

                <div class="world-map-countries compact-grid">
                    <div class="wm-country-col">
                        <h4>üîº Sources</h4>
                        <template x-for="c in worldMap.source_countries?.slice(0, 5)" :key="c.iso || c.name">
                            <div class="wm-country-row"
                                :class="{ 'selected': worldMapSelectedCountry === (c.iso || c.name) }"
                                @click="selectCountryForMap(c.iso || c.name)">
                                <span x-text="flagFromIso(c.iso || '??')"></span>
                                <span class="wm-c-name" x-text="c.name"></span>
                                <span class="wm-c-val text-cyan" x-text="c.bytes_fmt"></span>
                            </div>
                        </template>
                    </div>
                    <div class="wm-country-col">
                        <h4>üîΩ Dests</h4>
                        <template x-for="c in worldMap.dest_countries?.slice(0, 5)" :key="c.iso || c.name">
                            <div class="wm-country-row"
                                :class="{ 'selected': worldMapSelectedCountry === (c.iso || c.name) }"
                                @click="selectCountryForMap(c.iso || c.name)">
                                <span x-text="flagFromIso(c.iso || '??')"></span>
                                <span class="wm-c-name" x-text="c.name"></span>
                                <span class="wm-c-val text-purple" x-text="c.bytes_fmt"></span>
                            </div>
                        </template>
                    </div>
                    <div class="wm-country-col">
                        <h4>‚ö†Ô∏è Threats</h4>
                        <template x-for="c in worldMap.threat_countries?.slice(0, 5)" :key="c.iso || c.name">
                            <div class="wm-country-row"
                                :class="{ 'selected': worldMapSelectedCountry === (c.iso || c.name) }"
                                @click="selectCountryForMap(c.iso || c.name)">
                                <span x-text="flagFromIso(c.iso || '??')"></span>
                                <span class="wm-c-name" x-text="c.name"></span>
                                <span class="wm-c-val text-red" x-text="c.bytes_fmt || c.count || 'N/A'"></span>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            {% endcall %}
        </section>
    </div>
    <style>
        /* Radar Animation */
        .radar-scan {
            width: 8px;
            height: 8px;
            background: var(--signal-primary);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--signal-primary);
            animation: radar-ping 3s infinite;
        }

        @keyframes radar-ping {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
            }

            50% {
                transform: scale(1.2);
                opacity: 1;
                box-shadow: 0 0 20px var(--signal-primary);
            }

            100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
        }

        /* Context Cards */
        .ctx-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 6px;
            min-width: 140px;
        }

        .ctx-label {
            font-size: 0.7em;
            color: var(--text-tertiary);
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        .ctx-val {
            font-family: var(--font-mono);
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .ctx-sub {
            font-size: 0.75em;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 140px;
        }

        /* Stream Rows */
        .stream-row {
            display: flex;
            gap: 12px;
            padding: 6px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.02);
            transition: background 0.2s;
            align-items: baseline;
        }

        .stream-row:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .stream-time {
            font-family: var(--font-mono);
            font-size: 0.75em;
            color: var(--text-tertiary);
            width: 40px;
            flex-shrink: 0;
            text-align: right;
        }

        .stream-marker {
            width: 4px;
            height: 4px;
            background: var(--text-tertiary);
            border-radius: 50%;
            transform: translateY(-2px);
        }

        .stream-marker.marker-warn {
            background: var(--signal-warn);
            box-shadow: 0 0 5px var(--signal-warn);
        }

        .stream-marker.marker-notice {
            background: var(--signal-notice);
        }

        .stream-content {
            font-size: 0.9em;
            line-height: 1.4;
            color: var(--text-secondary);
        }

        .stream-type {
            font-size: 0.85em;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            margin-right: 6px;
        }

        /* Movers */
        .mover-group {
            margin-bottom: var(--space-6);
        }

        .mover-empty {
            font-size: 0.8em;
            color: var(--text-muted);
            font-style: italic;
            padding: 4px 0;
        }

        .mover-head {
            font-size: 0.75em;
            color: var(--text-tertiary);
            text-transform: uppercase;
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .mover-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 0;
        }

        .mover-rank {
            font-family: var(--font-mono);
            color: var(--text-tertiary);
            font-size: 0.8em;
            width: 15px;
        }

        .mover-info {
            flex: 1;
            min-width: 0;
        }

        .mover-main {
            font-size: 0.9em;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mover-sub {
            font-size: 0.75em;
            color: var(--text-tertiary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mover-val {
            font-family: var(--font-mono);
            font-size: 0.85em;
            color: var(--text-secondary);
        }
    </style>

    <script>
        function formatTimeAgoShort(ts) {
            if (!ts) return '';
            const sec = Math.floor((Date.now() / 1000) - ts);
            if (sec < 60) return sec + 's';
            if (sec < 3600) return Math.floor(sec / 60) + 'm';
            return Math.floor(sec / 3600) + 'h';
        }
    </script>
</div>