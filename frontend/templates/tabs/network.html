                                    <div class="alert-summary">
                                        <span class="alert-badge critical"
                                            x-show="alertHistory.by_severity?.critical > 0">üî¥ <span
                                                x-text="alertHistory.by_severity?.critical || 0"></span>
                                            critical</span>
                                        <span class="alert-badge high" x-show="alertHistory.by_severity?.high > 0">üü†
                                            <span x-text="alertHistory.by_severity?.high || 0"></span> high</span>
                                        <span class="alert-badge medium"
                                            x-show="alertHistory.by_severity?.medium > 0">üü°
                                            <span x-text="alertHistory.by_severity?.medium || 0"></span>
                                            medium</span>
                                        <span class="alert-badge low" x-show="alertHistory.by_severity?.low > 0">üü¢
                                            <span x-text="alertHistory.by_severity?.low || 0"></span> low</span>
                                        <span class="text-muted">Total: <span
                                                x-text="alertHistory.total || 0"></span></span>
                                    </div>
                                    <div class="alert-list">
                                        <template x-for="(a, idx) in filteredAlerts.slice(0, 10)" :key="idx">
                                            <div class="alert-row" :class="'severity-row-' + a.severity">
                                                <div class="alert-time" x-text="a.time_ago"></div>
                                                <div class="alert-info">
                                                    <span class="alert-type-badge"
                                                        :class="'cat-' + (a.category || a.type || 'unknown').toLowerCase()"
                                                        x-text="a.type || 'alert'"></span>
                                                    <span class="alert-msg" :title="a.msg" x-text="a.msg"></span>
                                                </div>
                                                <div class="alert-severity" :class="'sev-' + a.severity"
                                                    x-text="a.severity"></div>
                                            </div>
                                        </template>
                                        <template x-if="filteredAlerts.length === 0">
                                            <div class="alert-empty"
                                                x-text="alertFilter.severity !== 'all' || alertFilter.type !== 'all' ? 'üîç No matching alerts' : '‚úÖ No alerts in past 24 hours'">
                                            </div>
                                        </template>
                                    </div>
                                    {% endcall %}
                                </template>

                                <!-- Threats by Country Widget -->
                                <template x-if="isVisible('threatsByCountry')">
                                    {% call widget_card('threatsByCountry', 'Threats by Country', 'üåç',
                                    show_spinner=True) %}
                                    <div class="country-threat-list">
                                        <template
                                            x-if="threatsByCountry.countries && threatsByCountry.countries.length > 0">
                                            <div>
                                                <div class="text-85 text-muted mb-2">
                                                    <span x-text="threatsByCountry.total_countries || 0"></span>
                                                    countries
                                                    detected
                                                    <template x-if="threatsByCountry.has_fw_data">
                                                        <span> ¬∑ <span class="text-green"
                                                                x-text="threatsByCountry.total_blocked"></span>
                                                            blocked</span>
                                                    </template>
                                                </div>
                                                <template
                                                    x-for="(c, idx) in (threatsByCountry.countries || []).slice(0, 8)"
                                                    :key="c.country_code">
                                                    <div class="country-threat-item">
                                                        <span class="country-flag" x-text="c.country_code"></span>
                                                        <span class="country-name" x-text="c.country_name"></span>
                                                        <span class="country-count">
                                                            <span x-text="c.threat_count"></span>
                                                            <template x-if="c.blocked > 0">
                                                                <span class="text-green text-8 ml-1">üî•<span
                                                                        x-text="c.blocked"></span></span>
                                                            </template>
                                                        </span>
                                                    </div>
                                                </template>
                                            </div>
                                        </template>
                                        <template
                                            x-if="!threatsByCountry.countries || threatsByCountry.countries.length === 0">
                                            <div class="empty-state-compact">
                                                <span class="empty-icon">üåç</span>
                                                <span>No geo-located threats</span>
                                            </div>
                                        </template>
                                    </div>
                                    {% endcall %}
                                </template>

                                <!-- Threat Detections - MOVED TO FIREWALL TAB -->

                                <!-- Feed Health -->
                                <template x-if="isVisible('feedHealth')">
                                    {% set feed_actions %}
                                    <button class="icon-btn-small" @click="refreshFeed()" title="Refresh Feeds Now"
                                        class="text-green">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 12a9 9 0 11-2.5-6.3" />
                                            <path d="M21 3v6h-6" />
                                        </svg>
                                    </button>
                                    {% endset %}

                                    {% call widget_card('feedHealth', 'Feed Health', 'üì°', extra_actions=feed_actions,
                                    show_spinner=True) %}
                                    <!-- Summary Bar -->
                                    <div class="feed-summary-bar">
                                        <div class="feed-stat">
                                            <span class="feed-stat-value text-green"
                                                x-text="feedHealth.summary?.ok || 0"></span>
                                            <span class="feed-stat-label">OK</span>
                                        </div>
                                        <div class="feed-stat-divider">/</div>
                                        <div class="feed-stat">
                                            <span class="feed-stat-value"
                                                x-text="feedHealth.summary?.total || 0"></span>
                                            <span class="feed-stat-label">Feeds</span>
                                        </div>
                                        <div class="feed-stat-sep">¬∑</div>
                                        <div class="feed-stat">
                                            <span class="feed-stat-value text-cyan"
                                                x-text="(feedHealth.summary?.total_ips || 0).toLocaleString()"></span>
                                            <span class="feed-stat-label">IPs</span>
                                        </div>
                                        <div class="feed-stat-sep">¬∑</div>
                                        <div class="feed-stat">
                                            <span class="feed-stat-value text-muted"
                                                x-text="feedHealth.summary?.last_refresh || 'never'"></span>
                                        </div>
                                    </div>
                                    <!-- Feed List (Full Width) -->
                                    <div class="feed-list-full">
                                        <template x-for="(f, idx) in feedHealth.feeds" :key="f.name + idx">
                                            <div class="feed-item" :class="{ 'feed-error': f.status !== 'ok' }">
                                                <span class="feed-status-dot" :class="f.status"></span>
                                                <span class="feed-name-full" x-text="f.name" :title="f.name"></span>
                                                <span class="feed-ips-count"
                                                    x-text="(f.ips || 0).toLocaleString()"></span>
                                                <span class="feed-category-tag"
                                                    :class="'cat-' + (f.category || 'unknown').toLowerCase()"
                                                    x-text="f.category"></span>
                                            </div>
                                        </template>
                                        <template x-if="!feedHealth.feeds || feedHealth.feeds.length === 0">
                                            <div class="feed-empty">
                                                <span>üì° No feed data yet</span>
                                            </div>
                                        </template>
                                    </div>
                                    {% endcall %}
                                </template>

                                <!-- Top Malicious Ports -->
                                {% call widget_card('maliciousPorts', 'Top Malicious Ports', 'üîí', show_spinner=True) %}
                                <div class="text-9 text-muted mb-2">
                                    <template x-if="maliciousPorts.has_syslog">
                                        <span>Ports targeted by threats + blocked by firewall</span>
                                    </template>
                                    <template x-if="!maliciousPorts.has_syslog">
                                        <span>Ports most frequently seen in threat traffic</span>
                                    </template>
                                </div>
                                <div style="max-height: 240px; overflow-y: auto;">
                                    <table class="table-fixed table-compact">
                                        <thead>
                                            <tr>
                                                <th>Port</th>
                                                <th>FW Blocked</th>
                                                <th>Traffic</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="(p, i) in maliciousPorts.ports.slice(0, 15)"
                                                :key="p.port + '-' + i">
                                                <tr>
                                                    <td>
                                                        <strong class="text-cyan" x-text="p.port"></strong>
                                                        <template x-if="p.suspicious"><span
                                                                style="color: var(--neon-pink); font-size: 0.75em;">
                                                                ‚ö†</span></template>
                                                        <div class="text-8 text-muted" x-text="p.service || ''">
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <template x-if="p.blocked > 0">
                                                            <span class="text-green">üî• <span
                                                                    x-text="p.blocked"></span></span>
                                                        </template>
                                                        <template x-if="!p.blocked || p.blocked === 0">
                                                            <span class="text-muted">‚Äî</span>
                                                        </template>
                                                        <template x-if="p.unique_attackers > 1">
                                                            <div class="text-75 text-muted"
                                                                x-text="p.unique_attackers + ' IPs'"></div>
                                                        </template>
                                                    </td>
                                                    <td>
                                                        <template
                                                            x-if="p.bytes_fmt || (p.netflow_bytes || 0) > 0 || (p.netflow_flows || 0) > 0">
                                                            <div>
                                                                <strong class="text-green"
                                                                    x-text="p.bytes_fmt || (p.netflow_bytes ? fmtBytes(p.netflow_bytes) : '0 B')"></strong>
                                                                <div class="text-8 text-muted"
                                                                    x-text="(p.netflow_flows || 0) + ' flows'"></div>
                                                            </div>
                                                        </template>
                                                        <template
                                                            x-if="!p.bytes_fmt && (p.netflow_bytes || 0) === 0 && (p.netflow_flows || 0) === 0">
                                                            <span class="text-muted">‚Äî</span>
                                                        </template>
                                                    </td>
                                                </tr>
                                            </template>
                                            <template x-if="!maliciousPorts.ports || maliciousPorts.ports.length===0">
                                                <tr>
                                                    <td colspan="3" class="text-muted text-center">
                                                        No
                                                        malicious port data</td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                                {% endcall %}

                                <!-- Blocklist Match Rate -->
                                {% call widget_card('blocklist', 'Blocklist Match Rate', 'üõ°Ô∏è', show_spinner=True) %}
                                <div class="text-85 text-muted mb-2">
                                    Rate of flows matching blocklists / feeds
                                    <template x-if="blocklist.has_fw_data">
                                        <span class="text-green"> + FW blocks</span>
                                    </template>
                                </div>
                                <div class="h-25 mb-2 chart-expandable"
                                    @click="openFullscreenChart('blocklistChart', 'Blocklist Match Rate')"
